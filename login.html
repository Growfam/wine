<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=600, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>WINIX - –í—Ö—ñ–¥/–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</title>
    <script src="static/js/winix-core.js"></script>
    <script src="static/js/winix-connector.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            background: none;
        }

        .container {
            width: 100%;
            height: 100%;
            max-width: 600px;
            box-sizing: border-box;
            padding: 10px;
            position: relative;
            z-index: 1;
            background: url('assets/Fon.png') no-repeat center center;
            background-size: cover;
            animation: backgroundShift 15s infinite linear;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 0%; }
            50% { background-position: 10% 10%; }
            100% { background-position: 0% 0%; }
        }

        .logo-container {
            margin-top: 40px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 20px;
            box-shadow: 0 0 8px rgba(0, 201, 167, 0.8), 0 0 20px rgba(0, 201, 167, 0.4);
            animation: pulse 8s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 5px rgba(0, 201, 167, 0.3); }
            50% { transform: scale(1.1); box-shadow: 0 0 10px rgba(0, 201, 167, 0.6); }
            100% { transform: scale(1); box-shadow: 0 0 5px rgba(0, 201, 167, 0.3); }
        }

        .app-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 0 0 15px rgba(0, 201, 167, 0.7);
            animation: glow 11s infinite ease-in-out;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 18px;
            color: #ccc;
            margin-bottom: 30px;
        }

        @keyframes glow {
            0% { text-shadow: 0 0 5px rgba(0, 201, 167, 0.3); }
            72% { text-shadow: 0 0 15px rgba(0, 201, 167, 0.8), 0 0 30px rgba(0, 201, 167, 0.5); }
            100% { text-shadow: 0 0 5px rgba(0, 201, 167, 0.3); }
        }

        .auth-card {
            width: 90%;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .auth-tabs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(78, 181, 247, 0.3);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            color: #adb5bd;
            transition: all 0.3s ease;
            position: relative;
        }

        .auth-tab.active {
            color: #fff;
        }

        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #2D6EB6, #52C0BD);
            border-radius: 3px 3px 0 0;
        }

        .auth-content {
            display: none;
        }

        .auth-content.active {
            display: block;
        }

        .auth-title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #fff;
            text-shadow: 0 0 10px rgba(0, 201, 167, 0.7);
            letter-spacing: 1px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            color: #adb5bd;
            font-weight: bold;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border-radius: 15px;
            background: rgba(20, 30, 60, 0.7);
            border: 1px solid rgba(78, 181, 247, 0.2);
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #00C9A7;
            box-shadow: 0 0 10px rgba(0, 201, 167, 0.5);
        }

        .auth-button {
            width: 100%;
            background: linear-gradient(90deg, #2D6EB6, #52C0BD);
            border: none;
            border-radius: 25px;
            padding: 15px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .auth-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            background: linear-gradient(90deg, #3D7EC6, #62D0CD);
        }

        .auth-button:disabled {
            background: linear-gradient(90deg, #1E3C5A, #344959);
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .error-message {
            color: #f44336;
            text-align: center;
            font-size: 14px;
            margin-top: 15px;
            min-height: 20px;
        }

        .recovery-options {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .divider {
            width: 100%;
            text-align: center;
            position: relative;
            margin: 25px 0;
        }

        .divider::before {
            content: "";
            display: block;
            width: 100%;
            height: 1px;
            background: rgba(78, 181, 247, 0.3);
            position: absolute;
            top: 50%;
            left: 0;
        }

        .divider-text {
            background: rgba(15, 23, 42, 0.8);
            padding: 0 15px;
            position: relative;
            color: #ccc;
            font-weight: bold;
        }

        .recovery-button {
            width: 100%;
            background: rgba(20, 30, 60, 0.7);
            border: 1px solid rgba(78, 181, 247, 0.3);
            border-radius: 15px;
            padding: 15px;
            color: #f8f9fa;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .recovery-button:hover {
            background: rgba(45, 110, 182, 0.3);
            border: 1px solid rgba(78, 181, 247, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .icon {
            font-size: 18px;
        }

        .toast-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 201, 167, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
        }

        .toast-message.show {
            opacity: 1;
            transform: translate(-50%, 10px);
        }

        .toast-message.error {
            background-color: rgba(244, 67, 54, 0.9);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img src="assets/token.png" alt="WINIX Token" class="logo" onerror="this.src='https://via.placeholder.com/120?text=WINIX'">
            <div class="app-title">WINIX</div>
            <div class="subtitle" id="auth-subtitle">–í—Ö—ñ–¥ –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É</div>
        </div>

        <div class="auth-card">
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">–í—Ö—ñ–¥</div>
                <div class="auth-tab" data-tab="register">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</div>
            </div>

            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥—É -->
            <div class="auth-content active" id="login-content">
                <div class="input-group">
                    <label class="input-label" for="login-userId">ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</label>
                    <input type="text" id="login-userId" class="input-field" placeholder="–í–≤–µ–¥—ñ—Ç—å ID" autocomplete="username">
                </div>

                <div class="input-group">
                    <label class="input-label" for="login-password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="login-password" class="input-field" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
                </div>

                <div class="error-message" id="login-error-message"></div>

                <button id="login-button" class="auth-button">–£–≤—ñ–π—Ç–∏</button>

                <div class="divider">
                    <span class="divider-text">–∞–±–æ</span>
                </div>

                <div class="recovery-options">
                    <button id="recovery-button" class="recovery-button">
                        <span class="icon">üîë</span> –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ —á–µ—Ä–µ–∑ SID —Ñ—Ä–∞–∑—É
                    </button>
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
            <div class="auth-content" id="register-content">
                <div class="input-group">
                    <label class="input-label" for="register-userId">–û–±–µ—Ä—ñ—Ç—å ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</label>
                    <input type="text" id="register-userId" class="input-field" placeholder="–ú—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤" autocomplete="username">
                </div>

                <div class="input-group">
                    <label class="input-label" for="register-name">–í–∞—à–µ —ñ–º'—è</label>
                    <input type="text" id="register-name" class="input-field" placeholder="–Ø–∫ –¥–æ –≤–∞—Å –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è">
                </div>

                <div class="input-group">
                    <label class="input-label" for="register-password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="register-password" class="input-field" placeholder="–ú—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤" autocomplete="new-password">
                </div>

                <div class="input-group">
                    <label class="input-label" for="register-confirm-password">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é</label>
                    <input type="password" id="register-confirm-password" class="input-field" placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
                </div>

                <div class="error-message" id="register-error-message"></div>

                <button id="register-button" class="auth-button">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            </div>
        </div>
    </div>

    <div class="toast-message" id="toast-message"></div>

    <script>
        // –î–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è Telegram —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
        let telegramUserId = null;
        let telegramUserName = null;

        // ========== –°–ò–°–¢–ï–ú–ê –ö–ï–†–£–í–ê–ù–ù–Ø –ö–û–†–ò–°–¢–£–í–ê–ß–ê–ú–ò ==========

        // –ö–ª–∞—Å –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        class UserManager {
            constructor() {
                try {
                    console.log("–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è UserManager");

                    // –û—Ç—Ä–∏–º—É—î–º–æ –±–∞–∑—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ localStorage –∞–±–æ —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É
                    let usersData = localStorage.getItem('winix_users');

                    if (usersData) {
                        try {
                            this.users = JSON.parse(usersData);
                            console.log("–£—Å–ø—ñ—à–Ω–æ –∑—á–∏—Ç–∞–Ω–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –∫—ñ–ª—å–∫—ñ—Å—Ç—å:", this.users.length);
                        } catch (e) {
                            console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ä–æ–∑–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:", e);
                            this.users = [];
                        }
                    } else {
                        this.users = [];
                    }

                    // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–µ–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (—è–∫—â–æ –±–∞–∑–∞ –ø–æ—Ä–æ–∂–Ω—è)
                    if (this.users.length === 0) {
                        this.users = [
                            { userId: "12345678", password: "winix2025", name: "WINIX User" },
                            { userId: "87654321", password: "password123", name: "Test User" },
                            { userId: "55555555", password: "demo1234", name: "Demo Account" }
                        ];
                        this.saveUsers();
                    }
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ UserManager:", error);
                    this.users = [];
                }
            }

            // –ó–±–µ—Ä—ñ–≥–∞—î –±–∞–∑—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            saveUsers() {
                try {
                    localStorage.setItem('winix_users', JSON.stringify(this.users));
                    return true;
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –±–∞–∑–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:", error);
                    return false;
                }
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ —ñ—Å–Ω—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ —Ç–∞–∫–∏–º ID
            userExists(userId) {
                try {
                    if (!userId) return false;
                    return this.users.some(user => user.userId === userId);
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", error);
                    return false;
                }
            }

            // –î–æ–¥–∞—î –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            addUser(userId, password, name) {
                try {
                    if (this.userExists(userId)) {
                        return false; // –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î
                    }

                    this.users.push({ userId, password, name });
                    const result = this.saveUsers();

                    if (result) {
                        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                        this.initUserData(userId);
                    }

                    return result;
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", error);
                    return false;
                }
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            validateUser(userId, password) {
                try {
                    return this.users.find(user => user.userId === userId && user.password === password);
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", error);
                    return null;
                }
            }

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            initUserData(userId) {
                try {
                    // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å
                    localStorage.setItem(`${userId}_userTokens`, '100');
                    localStorage.setItem(`${userId}_userCoins`, '0');

                    // –ü–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
                    localStorage.setItem(`${userId}_transactions`, JSON.stringify([]));

                    // –î–∞–Ω—ñ —Å—Ç–µ–π–∫—ñ–Ω–≥—É
                    localStorage.setItem(`${userId}_userStakedTokens`, '0');
                    localStorage.setItem(`${userId}_userStakingRewards`, '0');

                    // –ü–æ—Ä–æ–∂–Ω—ñ –¥–∞–Ω—ñ —Å—Ç–µ–π–∫—ñ–Ω–≥—É
                    const emptyStakingData = {
                        hasActiveStaking: false,
                        stakingAmount: 0,
                        rewardPercent: 0,
                        expectedReward: 0,
                        period: 0,
                        startDate: null,
                        endDate: null,
                        remainingDays: 0
                    };
                    localStorage.setItem(`${userId}_stakingData`, JSON.stringify(emptyStakingData));
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", error);
                }
            }

            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            setCurrentUser(userId) {
                try {
                    localStorage.setItem('currentUserId', userId);
                    localStorage.setItem('isLoggedIn', 'true');

                    // –ö–æ–ø—ñ—é—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –∑–∞–≥–∞–ª—å–Ω—ñ –∫–ª—é—á—ñ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑—ñ —Å—Ç–∞—Ä–∏–º –∫–æ–¥–æ–º
                    this.syncUserData(userId);
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", error);
                }
            }

            // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑—ñ —Å—Ç–∞—Ä–∏–º –∫–æ–¥–æ–º
            syncUserData(userId) {
                try {
                    // –ö–æ–ø—ñ—é—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –∑–∞–≥–∞–ª—å–Ω—ñ –∫–ª—é—á—ñ
                    const userTokens = localStorage.getItem(`${userId}_userTokens`);
                    const userCoins = localStorage.getItem(`${userId}_userCoins`);
                    const transactions = localStorage.getItem(`${userId}_transactions`);
                    const userStakedTokens = localStorage.getItem(`${userId}_userStakedTokens`);
                    const userStakingRewards = localStorage.getItem(`${userId}_userStakingRewards`);
                    const stakingData = localStorage.getItem(`${userId}_stakingData`);

                    if (userTokens) localStorage.setItem('userTokens', userTokens);
                    if (userCoins) localStorage.setItem('userCoins', userCoins);
                    if (transactions) localStorage.setItem('transactions', transactions);
                    if (userStakedTokens) localStorage.setItem('userStakedTokens', userStakedTokens);
                    if (userStakingRewards) localStorage.setItem('userStakingRewards', userStakingRewards);
                    if (stakingData) localStorage.setItem('stakingData', stakingData);

                    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    const user = this.users.find(u => u.userId === userId);
                    if (user) {
                        localStorage.setItem('userName', user.name);
                    }
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", error);
                }
            }

            // –û—Ç—Ä–∏–º—É—î —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ ID
            getUserName(userId) {
                try {
                    const user = this.users.find(u => u.userId === userId);
                    return user ? user.name : '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á';
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", error);
                    return '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á';
                }
            }
        }

        // –°—Ç–≤–æ—Ä—é—î–º–æ –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        const userManager = new UserManager();

        // ========== –Ü–ù–¢–ï–†–§–ï–ô–° –Ü –í–ó–ê–Ñ–ú–û–î–Ü–Ø ==========

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast-message');
            toast.textContent = message;
            toast.classList.add('show');

            if (isError) {
                toast.classList.add('error');
            } else {
                toast.classList.remove('error');
            }

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (isLoggedIn) {
                // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É
                window.location.href = 'index.html';
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—Ö–æ–¥—É
        function login() {
            let userId = document.getElementById('login-userId').value.trim();
            const password = document.getElementById('login-password').value;
            const errorMessage = document.getElementById('login-error-message');

            // –Ø–∫—â–æ —î ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ Telegram, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –π–æ–≥–æ
            if (telegramUserId && document.getElementById('login-userId').disabled) {
                userId = telegramUserId;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–≤–µ–¥–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö
            if (!userId || !password) {
                errorMessage.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å ID —Ç–∞ –ø–∞—Ä–æ–ª—å';
                return;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤ –±–∞–∑—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            const user = userManager.validateUser(userId, password);

            if (user) {
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                userManager.setCurrentUser(userId);

                // –ü–æ–∫–∞–∑—É—î–º–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥
                showToast('–í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è...');

                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } else {
                errorMessage.textContent = '–ù–µ–≤—ñ—Ä–Ω–∏–π ID –∞–±–æ –ø–∞—Ä–æ–ª—å';
                showToast('–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É', true);
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
        function register() {
            let userId = document.getElementById('register-userId').value.trim();
            const name = document.getElementById('register-name').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const errorMessage = document.getElementById('register-error-message');

            // –Ø–∫—â–æ —î ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ Telegram, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –π–æ–≥–æ
            if (telegramUserId && document.getElementById('register-userId').disabled) {
                userId = telegramUserId;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–≤–µ–¥–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö
            if (!userId || !name || !password || !confirmPassword) {
                errorMessage.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è';
                return;
            }

            // –Ø–∫—â–æ ID –Ω–µ –∑ Telegram, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –π–æ–≥–æ –¥–æ–≤–∂–∏–Ω—É
            if (!telegramUserId && userId.length < 6) {
                errorMessage.textContent = 'ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –º–∞—î –±—É—Ç–∏ –Ω–µ –º–µ–Ω—à–µ 6 —Å–∏–º–≤–æ–ª—ñ–≤';
                return;
            }

            if (password.length < 6) {
                errorMessage.textContent = '–ü–∞—Ä–æ–ª—å –º–∞—î –±—É—Ç–∏ –Ω–µ –º–µ–Ω—à–µ 6 —Å–∏–º–≤–æ–ª—ñ–≤';
                return;
            }

            if (password !== confirmPassword) {
                errorMessage.textContent = '–ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å';
                return;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ ID –≤–∂–µ –∑–∞–π–Ω—è—Ç–∏–π
            if (userManager.userExists(userId)) {
                errorMessage.textContent = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î';
                return;
            }

            // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            const result = userManager.addUser(userId, password, name);

            if (result) {
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                userManager.setCurrentUser(userId);

                // –ü–æ–∫–∞–∑—É—î–º–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é
                showToast('–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è...');

                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } else {
                errorMessage.textContent = '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑';
                showToast('–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó', true);
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ –≤–∫–ª–∞–¥–∫–∞–º–∏ –≤—Ö–æ–¥—É —Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
        function switchTab(tabName) {
            try {
                console.log(`–ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É: ${tabName}`);

                // –î–µ–∞–∫—Ç–∏–≤—É—î–º–æ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.classList.remove('active');
                });

                // –î–µ–∞–∫—Ç–∏–≤—É—î–º–æ –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
                document.querySelectorAll('.auth-content').forEach(content => {
                    content.classList.remove('active');
                });

                // –ê–∫—Ç–∏–≤—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—É –≤–∫–ª–∞–¥–∫—É
                const activeTab = document.querySelector(`.auth-tab[data-tab="${tabName}"]`);
                if (activeTab) {
                    activeTab.classList.add('active');
                } else {
                    console.error(`–í–∫–ª–∞–¥–∫–∞ ${tabName} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞`);
                    return;
                }

                // –ê–∫—Ç–∏–≤—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
                const activeContent = document.getElementById(`${tabName}-content`);
                if (activeContent) {
                    activeContent.classList.add('active');
                } else {
                    console.error(`–ö–æ–Ω—Ç–µ–Ω—Ç ${tabName}-content –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ`);
                    return;
                }

                // –ó–º—ñ–Ω—é—î–º–æ –ø—ñ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
                const subtitle = document.getElementById('auth-subtitle');
                if (subtitle) {
                    if (tabName === 'login') {
                        subtitle.textContent = '–í—Ö—ñ–¥ –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É';
                    } else {
                        subtitle.textContent = '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É';
                    }
                }

                // –û—á–∏—â–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏
                const loginError = document.getElementById('login-error-message');
                const registerError = document.getElementById('register-error-message');

                if (loginError) loginError.textContent = '';
                if (registerError) registerError.textContent = '';

                console.log(`–ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É ${tabName} –∑–∞–≤–µ—Ä—à–µ–Ω–æ`);
            } catch (error) {
                console.error(`–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ –Ω–∞ –≤–∫–ª–∞–¥–∫—É ${tabName}:`, error);
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±—Ä–æ–±–Ω–∏–∫–∞ –ø–æ–¥—ñ—ó
        function safeAddEventListener(elementId, eventType, handler) {
            const element = document.getElementById(elementId);
            if (element) {
                element.addEventListener(eventType, handler);
                console.log(`–û–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó ${eventType} —É—Å–ø—ñ—à–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –µ–ª–µ–º–µ–Ω—Ç–∞ ${elementId}`);
            } else {
                console.error(`–ï–ª–µ–º–µ–Ω—Ç –∑ ID ${elementId} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó ${eventType}`);
            }
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log("–ü–æ—á–∞—Ç–æ–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏");

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π
                checkLoginStatus();

                console.log("–°—Ç–∞—Ç—É—Å –≤—Ö–æ–¥—É –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ");

                // –Ø–∫—â–æ –æ—Ç—Ä–∏–º–∞–Ω–æ ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ Telegram, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
                if (telegramUserId) {
                    console.log("–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è ID Telegram:", telegramUserId);

                    // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –ø–æ–ª—è —Ñ–æ—Ä–º–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
                    const registerUserIdInput = document.getElementById('register-userId');
                    if (registerUserIdInput) {
                        registerUserIdInput.value = telegramUserId;
                        registerUserIdInput.disabled = true; // –ë–ª–æ–∫—É—î–º–æ –ø–æ–ª–µ, –æ—Å–∫—ñ–ª—å–∫–∏ ID —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π
                        console.log("–ó–∞–ø–æ–≤–Ω–µ–Ω–æ –ø–æ–ª–µ ID –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó");
                    }

                    // –Ø–∫—â–æ —î —ñ–º'—è, –∑–∞–ø–æ–≤–Ω—é—î–º–æ –ø–æ–ª–µ —ñ–º–µ–Ω—ñ
                    if (telegramUserName) {
                        const nameInput = document.getElementById('register-name');
                        if (nameInput) {
                            nameInput.value = telegramUserName;
                            console.log("–ó–∞–ø–æ–≤–Ω–µ–Ω–æ –ø–æ–ª–µ —ñ–º–µ–Ω—ñ");
                        }
                    }

                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π
                    if (userManager.userExists(telegramUserId)) {
                        // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π, –ø–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –≤—Ö–æ–¥—É
                        switchTab('login');

                        // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –ø–æ–ª–µ ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ —Ñ–æ—Ä–º—ñ –≤—Ö–æ–¥—É
                        const loginUserIdInput = document.getElementById('login-userId');
                        if (loginUserIdInput) {
                            loginUserIdInput.value = telegramUserId;
                            loginUserIdInput.disabled = true; // –ë–ª–æ–∫—É—î–º–æ –ø–æ–ª–µ, –æ—Å–∫—ñ–ª—å–∫–∏ ID —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π
                        }

                        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—é
                        document.getElementById('login-password').focus();
                    } else {
                        // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —â–µ –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π, –ø–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
                        switchTab('register');
                    }
                }

                console.log("–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫");

                // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫
                const tabsContainer = document.querySelector('.auth-tabs');
                if (tabsContainer) {
                    tabsContainer.addEventListener('click', function(e) {
                        const tab = e.target.closest('.auth-tab');
                        if (tab) {
                            const tabName = tab.getAttribute('data-tab');
                            switchTab(tabName);
                        }
                    });
                    console.log("–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫");
                }

                // –ë–µ–∑–ø–µ—á–Ω–æ –¥–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
                safeAddEventListener('login-button', 'click', function() {
                    console.log("–ö–ª—ñ–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥—É");
                    login();
                });

                safeAddEventListener('register-button', 'click', function() {
                    console.log("–ö–ª—ñ–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó");
                    register();
                });

                safeAddEventListener('recovery-button', 'click', function() {
                    console.log("–ö–ª—ñ–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è");
                    window.location.href = 'restore.html';
                });

                // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –∫–ª–∞–≤—ñ—à—ñ Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥—É
                safeAddEventListener('login-password', 'keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });

                safeAddEventListener('register-confirm-password', 'keypress', function(e) {
                    if (e.key === 'Enter') {
                        register();
                    }
                });

                console.log("–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏:", error);
                alert("–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏. –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É.");
            }
        });
    </script>
</body>
</html>