<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WINIX - Реферальна програма</title>
    <link rel="stylesheet" href="css/earn/styles.css">
    <link rel="stylesheet" href="css/earn/animations.css">
    <link rel="stylesheet" href="css/earn/winix-icons.css">
    <link rel="stylesheet" href="css/referrals/referrals.css">
    <link rel="stylesheet" href="css/referrals/referrals-animations.css">
    <link rel="stylesheet" href="css/referrals/referrals-tabs.css">
    <link rel="stylesheet" href="css/referrals/referral-levels.css">
    <link rel="stylesheet" href="css/referrals/referral-structure.css">
    <link rel="stylesheet" href="css/referrals/percentage-rewards.css">
    <link rel="stylesheet" href="css/referrals/referral-activity.css">
    <link rel="stylesheet" href="css/referrals/badges-tasks.css">
    <link rel="preload" href="assets/badges-icons.svg" as="image" type="image/svg+xml">
</head>
<body>
    <!-- SVG фільтри для іконок -->
    <svg class="winix-filters">
      <defs>
        <!-- Синє світіння -->
        <filter id="blue-glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
          <feFlood flood-color="#4EB5F7" flood-opacity="0.5" result="color" />
          <feComposite in="color" in2="blur" operator="in" result="glow" />
          <feMerge>
            <feMergeNode in="glow" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>

        <!-- Бірюзове світіння -->
        <filter id="teal-glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
          <feFlood flood-color="#00C9A7" flood-opacity="0.5" result="color" />
          <feComposite in="color" in2="blur" operator="in" result="glow" />
          <feMerge>
            <feMergeNode in="glow" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>

        <!-- Золоте світіння -->
        <filter id="gold-glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
          <feFlood flood-color="#FFD700" flood-opacity="0.5" result="color" />
          <feComposite in="color" in2="blur" operator="in" result="glow" />
          <feMerge>
            <feMergeNode in="glow" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>
    </svg>

    <div class="container">
        <!-- Шапка сторінки -->
        <header class="header" style="color: white;">
            <div class="user-profile">
                <div class="profile-avatar">W</div>
                <div class="user-id-container">
                    <div class="user-id-label">Ваш ID</div>
                    <div class="user-id-value" id="header-user-id">Loading...</div>
                </div>
            </div>
            <div class="winix-title">WINIX</div>
            <div class="balance-container">
                <div class="jeton-balance">
                    <div class="balance-value" id="user-coins">-</div>
                    <div class="balance-label">Ticket</div>
                </div>
                <div class="winix-balance">
                    <div class="balance-value" id="user-tokens">-</div>
                    <div class="balance-label">Winix</div>
                </div>
            </div>
        </header>

        <!-- Основний контент -->
        <section class="category-card referral-section">
            <h2 class="category-title">Реферальна програма</h2>

            <!-- Головні вкладки реферальної системи -->
            <div class="main-tabs">
                <div class="tab-button active" data-tab="referrals">Реферали</div>
                <div class="tab-button" data-tab="badges">Бейджі</div>
                <div class="tab-button" data-tab="statistics">Статистика</div>
            </div>

            <!-- Контент вкладок -->
            <div class="tab-content">
                <!-- ВКЛАДКА 1: РЕФЕРАЛИ -->
                <div class="main-tab-pane active" id="referrals-tab">
                    <!-- Реферальне посилання -->
                    <div class="rewards-container">
                        <h3 class="referral-subtitle">Ваше реферальне посилання</h3>
                        <div class="rewards-box" style="flex-direction: column;">
                            <div class="reward-item">
                                <div style="width: 100%; text-align: center; display: flex; flex-direction: column; align-items: center;">
                                    <div class="link-display" style="width: 100%; margin-bottom: 15px;">Завантаження...</div>
                                    <button class="copy-button" style="margin-top: 10px; width: 100%; display: flex; justify-content: center;">
                                        <span class="copy-icon"></span>
                                        <span class="button-text">Копіювати</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <p class="referral-info">
                            Діліться своїм посиланням та заробляйте з кожного реферала!
                        </p>
                    </div>

                    <!-- Винагороди -->
                    <div class="rewards-container">
                        <h3 class="referral-subtitle">Ваші винагороди</h3>
                        <div class="rewards-box">
                            <div class="reward-item">
                                <div class="reward-icon direct-bonus-icon"></div>
                                <div class="reward-details">
                                    <div class="reward-title">Бонус за реферала</div>
                                    <div class="reward-description"><span class="bonus-amount" data-value="direct-bonus">-</span> winix за кожного нового реферала</div>
                                </div>
                            </div>
                            <div class="reward-item">
                                <div class="reward-icon percentage-icon"></div>
                                <div class="reward-details">
                                    <div class="reward-title">Відсотки від прибутку</div>
                                    <div class="reward-description"><span class="level1-percentage" data-value="level1-percentage">-</span>% від рефералів 1-го рівня, <span class="level2-percentage" data-value="level2-percentage">-</span>% від 2-го рівня</div>
                                </div>
                            </div>
                            <div class="reward-item">
                                <div class="reward-icon badge-icon"></div>
                                <div class="reward-details">
                                    <div class="reward-title">Бейджі та завдання</div>
                                    <div class="reward-description">Отримуйте винагороди за бейджі та виконані завдання</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Історія бонусів -->
                    <div class="bonus-history-container">
                        <h3 class="referral-subtitle">Історія бонусів</h3>
                        <div class="bonus-history-items" id="bonus-history-items">
                            <div class="loading-placeholder">
                                <p style="color: #888; text-align: center;">Завантаження історії бонусів...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Інструкція -->
                    <div class="instructions-container">
                        <h3 class="referral-subtitle">Як це працює?</h3>
                        <div class="instructions-box">
                            <div class="instruction-step">
                                <div class="step-number">1</div>
                                <div class="step-details">
                                    <div class="step-title">Поділіться своїм посиланням</div>
                                    <div class="step-description">Відправте своє реферальне посилання друзям через месенджери або соціальні мережі</div>
                                </div>
                            </div>
                            <div class="instruction-step">
                                <div class="step-number">2</div>
                                <div class="step-details">
                                    <div class="step-title">Приведіть нових користувачів</div>
                                    <div class="step-description">Коли нові користувачі реєструються за вашим посиланням, вони стають вашими рефералами</div>
                                </div>
                            </div>
                            <div class="instruction-step">
                                <div class="step-number">3</div>
                                <div class="step-details">
                                    <div class="step-title">Отримуйте винагороди</div>
                                    <div class="step-description">Заробляйте <span class="bonus-amount-instruction" data-value="direct-bonus">-</span> winix за кожного реферала, відсотки від їхнього прибутку та винагороди за бейджі</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ВКЛАДКА 2: БЕЙДЖІ -->
                <div class="main-tab-pane" id="badges-tab">
                    <!-- SVG для бейджів -->
                    <div style="display: none;">
                        <svg width="0" height="0">
                            <defs>
                                <!-- Градієнт для бейджу "Сміливець" -->
                                <linearGradient id="brave-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#ff7e5f" />
                                    <stop offset="100%" stop-color="#feb47b" />
                                </linearGradient>

                                <!-- Градієнт для бейджу "Новатор" -->
                                <linearGradient id="innovator-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#4eb5f7" />
                                    <stop offset="100%" stop-color="#2b6ecf" />
                                </linearGradient>

                                <!-- Градієнт для бейджу "Легенда" -->
                                <linearGradient id="legend-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#FFD700" />
                                    <stop offset="100%" stop-color="#FFA500" />
                                </linearGradient>

                                <!-- Градієнт для бейджу "Візіонер" -->
                                <linearGradient id="visionary-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#8E24AA" />
                                    <stop offset="100%" stop-color="#3F51B5" />
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>

                    <!-- Статистика бейджів -->
                    <div class="badges-stats-container">
                        <div class="badges-stats-item">
                            <div class="badges-stats-icon brave-badge-icon"></div>
                            <div class="badges-stats-value" id="earned-badges-count">-</div>
                            <div class="badges-stats-label">Зароблені бейджі</div>
                        </div>
                        <div class="badges-stats-item">
                            <div class="badges-stats-icon legend-badge-icon"></div>
                            <div class="badges-stats-value" id="total-badges-count">-</div>
                            <div class="badges-stats-label">Всього бейджів</div>
                        </div>
                        <div class="badges-stats-item">
                            <div class="badges-stats-icon innovator-badge-icon"></div>
                            <div class="badges-stats-value" id="remaining-badges-count">-</div>
                            <div class="badges-stats-label">Залишилось зібрати</div>
                        </div>
                    </div>

                    <!-- Наступний бейдж -->
                    <div class="next-badge-container" id="next-badge-container" style="display: none;">
                        <div class="next-badge-info">
                            <div class="next-badge-title" id="next-badge-title">Наступний бейдж: -</div>
                            <div class="next-badge-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="next-badge-progress" style="width: 0%"></div>
                                </div>
                                <div class="progress-text" id="next-badge-progress-text">-</div>
                            </div>
                            <div class="next-badge-remaining" id="next-badge-remaining">-</div>
                        </div>
                    </div>

                    <!-- Список бейджів -->
                    <div class="badges-list-container">
                        <h3 class="referral-subtitle">Бейджі за запрошення</h3>
                        <div class="badges-list" id="badges-list">
                            <!-- Бейджі будуть додані динамічно -->
                            <div class="loading-placeholder">
                                <p style="color: #888; text-align: center;">Завантаження бейджів...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ВКЛАДКА 3: СТАТИСТИКА -->
                <div class="main-tab-pane" id="statistics-tab">
                    <!-- Картки з показниками активності -->
                    <div class="activity-stats-container">
                        <div class="activity-stats-card">
                            <div class="activity-stats-icon active-referrals-icon"></div>
                            <div class="activity-stats-value" id="active-referrals-count">-</div>
                            <div class="activity-stats-label">Активні реферали</div>
                        </div>
                        <div class="activity-stats-card">
                            <div class="activity-stats-icon inactive-referrals-icon"></div>
                            <div class="activity-stats-value" id="inactive-referrals-count">-</div>
                            <div class="activity-stats-label">Неактивні реферали</div>
                        </div>
                        <div class="activity-stats-card">
                            <div class="activity-stats-icon conversion-rate-icon"></div>
                            <div class="activity-stats-value" id="conversion-rate">-</div>
                            <div class="activity-stats-label">Відсоток активності</div>
                        </div>
                    </div>

                    <!-- Критерії активності -->
                    <div class="activity-criteria-container">
                        <div class="activity-criteria-title">Критерії активності рефералів</div>
                        <div class="activity-criteria-items">
                            <div class="activity-criteria-item">
                                <div class="activity-criteria-label">Мінімальна кількість розіграшів</div>
                                <div class="activity-criteria-value" data-criteria="min-draws">-</div>
                            </div>
                            <div class="activity-criteria-item">
                                <div class="activity-criteria-label">Мінімальна кількість запрошених</div>
                                <div class="activity-criteria-value" data-criteria="min-invited">-</div>
                            </div>
                            <div class="activity-criteria-item">
                                <div class="activity-criteria-label">Достатньо виконання хоча б одного критерію</div>
                            </div>
                        </div>
                    </div>

                    <!-- Таблиця активності рефералів -->
                    <div class="referral-activity-table">
                        <div class="activity-table-header">
                            <div class="activity-table-col activity-col-id">ID реферала</div>
                            <div class="activity-table-col activity-col-draws">Розіграші</div>
                            <div class="activity-table-col activity-col-invited">Запрошені</div>
                            <div class="activity-table-col activity-col-status">Статус</div>
                        </div>
                        <div class="activity-table-body" id="activity-table-body">
                            <div class="loading-placeholder">
                                <p style="color: #888; text-align: center; padding: 20px;">Завантаження даних про активність...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Рекомендації щодо активності -->
                    <div class="activity-recommendations">
                        <div class="recommendations-title">Рекомендації</div>
                        <div class="recommendations-list" id="activity-recommendations">
                            <div class="loading-placeholder">
                                <p style="color: #888; text-align: center;">Завантаження рекомендацій...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Структура рефералів -->
                    <div class="referral-structure-container">
                        <h3 class="referral-subtitle">Структура рефералів</h3>
                        <div class="structure-info">
                            <div class="structure-item">
                                <div class="structure-label">Загальна кількість</div>
                                <div class="structure-value total-referrals-count">-</div>
                            </div>
                            <div class="structure-item">
                                <div class="structure-label">Активні реферали</div>
                                <div class="structure-value active-referrals-count">-</div>
                            </div>
                            <div class="structure-item">
                                <div class="structure-label">% конверсії</div>
                                <div class="structure-value conversion-rate">-</div>
                            </div>
                        </div>

                        <!-- Вкладки для перегляду рефералів -->
                        <div class="referral-tabs">
                            <div class="referral-tab active" data-tab="level1">1-й рівень</div>
                            <div class="referral-tab" data-tab="level2">2-й рівень</div>
                            <div class="referral-tab" data-tab="hierarchy">Ланцюжок</div>
                        </div>

                        <!-- Контент вкладок -->
                        <div class="referral-tab-content">
                            <!-- Вкладка рефералів 1-го рівня -->
                            <div class="tab-pane active" id="level1-tab">
                                <div class="referral-list" id="level1-list">
                                    <div class="loading-placeholder">
                                        <p style="color: #888; text-align: center;">Завантаження рефералів 1-го рівня...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Вкладка рефералів 2-го рівня -->
                            <div class="tab-pane" id="level2-tab">
                                <div class="referral-list" id="level2-list">
                                    <div class="loading-placeholder">
                                        <p style="color: #888; text-align: center;">Завантаження рефералів 2-го рівня...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Вкладка ієрархії рефералів -->
                            <div class="tab-pane" id="hierarchy-tab">
                                <div class="referral-hierarchy" id="referral-hierarchy">
                                    <div class="loading-placeholder">
                                        <p style="color: #888; text-align: center;">Завантаження ієрархії рефералів...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Деталі реферала (показується при кліку на реферала) -->
            <div class="referral-details" id="referral-details">
                <div class="referral-details-header">
                    <div class="referral-details-title">Інформація про реферала</div>
                    <div class="referral-details-close">&times;</div>
                </div>
                <div class="referral-details-content">
                    <div class="detail-item">
                        <div class="detail-label">ID</div>
                        <div class="detail-value" id="detail-id">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Дата реєстрації</div>
                        <div class="detail-value" id="detail-date">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Статус</div>
                        <div class="detail-value" id="detail-status">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Заробіток</div>
                        <div class="detail-value" id="detail-earnings">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Останнє відвідування</div>
                        <div class="detail-value" id="detail-last-activity">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Кількість рефералів</div>
                        <div class="detail-value" id="detail-referral-count">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Участь в розіграшах</div>
                        <div class="detail-value" id="detail-draws">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Запрошені реферали</div>
                        <div class="detail-value" id="detail-invited">-</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Причина активності</div>
                        <div class="detail-value" id="detail-activity-reason">-</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Нижня навігаційна панель -->
        <nav class="nav-bar">
            <div class="nav-item">
                <div class="icon-wrapper">
                    <img src="assets/home-icon.png" alt="Home">
                </div>
                <span>Home</span>
            </div>
            <div class="nav-item">
                <div class="icon-wrapper">
                    <img src="assets/earn-icon.png" alt="Earn">
                </div>
                <span>Earn</span>
            </div>
            <div class="nav-item active">
                <div class="icon-wrapper">
                    <img src="assets/referrals-icon.png" alt="Referral">
                </div>
                <span>Referral</span>
            </div>
            <div class="nav-item">
                <div class="icon-wrapper">
                    <img src="assets/wallet-icon.png" alt="Wallet">
                </div>
                <span>Wallet</span>
            </div>
            <div class="nav-item">
                <div class="icon-wrapper">
                    <img src="assets/general-icon.png" alt="General">
                </div>
                <span>General</span>
            </div>
        </nav>
    </div>

    <!-- Повідомлення про копіювання -->
    <div class="toast-message" id="copy-toast">
        Посилання скопійовано!
    </div>

    <style>
        .loading-placeholder {
            width: 100%;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-message.warning {
            background-color: #ff9800;
            color: white;
        }

        .toast-message.error {
            background-color: #f44336;
            color: white;
        }

        .toast-message.success {
            background-color: #4caf50;
            color: white;
        }
    </style>

    <!-- Основні скрипти -->
    <script src="js/telegram-web-app.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/core.js"></script>
    <script src="js/referrals/api.js"></script>

    <!-- Реферальні модулі -->
    <script src="js/referrals/constants.js"></script>
    <script src="js/referrals/utils.js"></script>
    <script src="js/referrals/services.js"></script>
    <script src="js/referrals/store.js"></script>
    <script src="js/referrals/Integration.js"></script>

    <!-- Динамічний контроллер даних -->
    <script src="js/referrals/dynamic-data-controller.js"></script>

    <!-- Ініціалізація реферальної системи -->
    <script>
        console.log("🌟 [MAIN] ===== ПОЧАТОК ГОЛОВНОГО СКРИПТУ =====");
        console.log("🕐 [MAIN] Час:", new Date().toISOString());

        // Глобальний контролер динамічних даних
        window.ReferralDynamicData = null;

        async function initializeAllSystems() {
            console.log("🚀 [MAIN] Ініціалізація всіх систем...");

            try {
                // 1. Ініціалізація Telegram WebApp
                initializeTelegramWebApp();

                // 2. Отримання ID користувача
                const userId = getUserId();
                if (!userId) {
                    throw new Error("Не вдалося отримати ID користувача");
                }

                // 3. Ініціалізація динамічного контролера даних
                console.log("🔄 [MAIN] Ініціалізація динамічного контролера...");
                window.ReferralDynamicData = new DynamicDataController(userId);

                // 4. Завантаження конфігурації та початкових даних
                console.log("🔄 [MAIN] Завантаження конфігурації...");
                await window.ReferralDynamicData.initialize();

                // 5. Ініціалізація реферальної системи
                console.log("🔄 [MAIN] Ініціалізація реферальної системи...");
                await safeInitReferralModules();

                console.log("✅ [MAIN] Всі системи успішно ініціалізовані!");

            } catch (error) {
                console.error("❌ [MAIN] Помилка ініціалізації:", error);
                showErrorToast("Помилка ініціалізації: " + error.message);
            }
        }

        function initializeTelegramWebApp() {
            console.log("🔄 [TELEGRAM-INIT] Ініціалізація Telegram WebApp...");

            if (!window.Telegram || !window.Telegram.WebApp) {
                console.error("❌ [TELEGRAM-INIT] Telegram WebApp API не завантажено!");
                return;
            }

            try {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();

                if (window.Telegram.WebApp.initDataUnsafe?.user) {
                    const user = window.Telegram.WebApp.initDataUnsafe.user;
                    const userId = parseInt(user.id);
                    localStorage.setItem('telegram_user_id', userId.toString());

                    // Оновлюємо ID в DOM
                    setTimeout(() => {
                        document.querySelectorAll('.user-id-value').forEach(element => {
                            element.textContent = userId;
                        });
                    }, 100);
                }
            } catch (e) {
                console.error("❌ [TELEGRAM-INIT] Помилка ініціалізації:", e);
            }
        }

        function safeInitReferralModules() {
            console.log("🔄 [MAIN] Перевірка та ініціалізація реферальних модулів...");

            const moduleChecks = {
                ReferralConstants: typeof window.ReferralConstants !== 'undefined',
                ReferralUtils: typeof window.ReferralUtils !== 'undefined',
                ReferralServices: typeof window.ReferralServices !== 'undefined',
                ReferralAPI: typeof window.ReferralAPI !== 'undefined',
                ReferralStore: typeof window.ReferralStore !== 'undefined',
                initReferralSystem: typeof window.initReferralSystem === 'function'
            };

            console.log("📊 [MAIN] Статус модулів:", moduleChecks);

            const missingModules = Object.keys(moduleChecks).filter(module => !moduleChecks[module]);
            if (missingModules.length > 0) {
                throw new Error("Відсутні модулі: " + missingModules.join(', '));
            }

            return window.initReferralSystem();
        }

        function getUserId() {
            console.log("🔍 [MAIN] Отримання ID користувача...");

            // Telegram WebApp
            if (window.Telegram?.WebApp?.initDataUnsafe?.user?.id) {
                return parseInt(window.Telegram.WebApp.initDataUnsafe.user.id);
            }

            // localStorage
            const storedId = localStorage.getItem('telegram_user_id') || localStorage.getItem('user_id');
            if (storedId) {
                const numericId = parseInt(storedId);
                if (!isNaN(numericId)) return numericId;
            }

            return null;
        }

        function showErrorToast(message) {
            const toast = document.getElementById('copy-toast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('show', 'error');
                setTimeout(() => toast.classList.remove('show', 'error'), 5000);
            }
        }

        // Ініціалізація базових обробників подій
        document.addEventListener('DOMContentLoaded', function() {
            console.log("🎯 [BASE-HANDLERS] Ініціалізація обробників...");

            // Обробник копіювання посилання
            const copyButton = document.querySelector('.copy-button');
            if (copyButton) {
                copyButton.addEventListener('click', handleCopyLink);
            }

            // Обробники вкладок
            initializeTabs();

            // Обробник закриття деталей
            const closeButton = document.querySelector('.referral-details-close');
            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    document.getElementById('referral-details').classList.remove('show');
                });
            }

            // Обробники навігації
            initializeNavigation();

            // Запуск ініціалізації систем
            initializeAllSystems();
        });

        function handleCopyLink() {
            const linkDisplay = document.querySelector('.link-display');
            const linkText = linkDisplay?.textContent;

            if (linkText && linkText !== 'Завантаження...') {
                navigator.clipboard.writeText(linkText)
                    .then(() => {
                        showSuccessToast('Посилання скопійовано!');
                        this.classList.add('clicked');
                        setTimeout(() => this.classList.remove('clicked'), 300);
                    })
                    .catch(err => {
                        console.error('Помилка копіювання:', err);
                        showErrorToast('Помилка копіювання');
                    });
            } else {
                showErrorToast('Посилання ще завантажується');
            }
        }

        function initializeTabs() {
            // Головні вкладки
            document.querySelectorAll('.main-tabs .tab-button').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this, '.main-tabs .tab-button', '.main-tab-pane', 'data-tab');
                });
            });

            // Внутрішні вкладки
            document.querySelectorAll('.referral-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this, '.referral-tab', '.tab-pane', 'data-tab');
                });
            });
        }

        function switchTab(clickedTab, tabSelector, paneSelector, dataAttr) {
            // Видаляємо active з усіх вкладок
            document.querySelectorAll(tabSelector).forEach(t => t.classList.remove('active'));

            // Додаємо active до обраної
            clickedTab.classList.add('active');

            // Перемикаємо панелі
            const tabId = clickedTab.getAttribute(dataAttr);
            document.querySelectorAll(paneSelector).forEach(pane => {
                pane.classList.remove('active');
            });

            const activePane = document.getElementById(tabId + '-tab');
            if (activePane) activePane.classList.add('active');
        }

        function initializeNavigation() {
            document.querySelectorAll('.nav-bar .nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const sectionName = this.querySelector('span').textContent.toLowerCase();
                    const routes = {
                        'home': 'original-index.html',
                        'earn': 'earn.html',
                        'referral': 'referrals.html',
                        'wallet': 'wallet.html',
                        'general': 'general.html'
                    };

                    const targetUrl = routes[sectionName];
                    if (targetUrl && targetUrl !== 'referrals.html') {
                        window.location.href = targetUrl;
                    }
                });
            });
        }

        function showSuccessToast(message) {
            const toast = document.getElementById('copy-toast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('show', 'success');
                setTimeout(() => toast.classList.remove('show', 'success'), 3000);
            }
        }
    </script>
</body>
</html>