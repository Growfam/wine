<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>WINIX - Налаштування</title>

    <script src="js/winix-init.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/language.js"></script>
    <script src="js/winix-id-utils.js"></script>
    <script src="js/winix-id-monitor.js"></script>
    <script src="js/winix-core.js"></script>
    <script src="js/winix-connector.js"></script>
    <script src="js/winix-all-in-one.js"></script>

    <style>
        :root {
            /* Основні кольори для теми */
            --primary-gradient: linear-gradient(90deg, #1A1A2E, #0F3460, #00C9A7);
            --secondary-color: #4eb5f7;
            --bg-card: rgba(30, 39, 70, 0.8);
            --bg-item: rgba(20, 30, 60, 0.7);
            --bg-active: rgba(0, 201, 167, 0.3);
            --text-color: #fff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --glow-color: rgba(0, 201, 167, 0.5);
            --border-color: rgba(78, 181, 247, 0.2);
            --positive-color: #4caf50;
            --negative-color: #f44336;
            --neutral-color: #9e9e9e;
            --accent-color: #ff9800;
            --premium-color: #ffedb2;

            /* Основні розміри */
            --container-max-width: 37.5rem; /* 600px */
            --header-height: 3.5rem; /* 56px */
            --nav-height: 4.5rem; /* 72px */
            --bottom-padding: 6rem; /* 96px */
            --card-border-radius: 1.5rem; /* 24px */
            --item-border-radius: 0.75rem; /* 12px */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
            color: var(--text-color);
            background: none;
            display: flex;
            justify-content: center;
            width: 100%;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            height: 100vh;
            max-width: var(--container-max-width);
            margin: 0 auto;
            box-sizing: border-box;
            padding: 0.625rem; /* 10px */
            position: relative;
            z-index: 1;
            background: url('assets/Fon.png') no-repeat center center;
            background-size: cover;
            animation: backgroundShift 15s infinite linear;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.9375rem; /* 15px */
            overflow-y: auto;
            padding-bottom: var(--bottom-padding);
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-color) transparent;
        }

        .container::-webkit-scrollbar {
            width: 0.375rem; /* 6px */
        }

        .container::-webkit-scrollbar-track {
            background: transparent;
        }

        .container::-webkit-scrollbar-thumb {
            background-color: var(--secondary-color);
            border-radius: 1.25rem; /* 20px */
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 0%; }
            50% { background-position: 10% 10%; }
            100% { background-position: 0% 0%; }
        }

        .header {
            background: var(--primary-gradient);
            border-radius: 1.5625rem; /* 25px */
            padding: 0.5rem 1rem; /* 8px 16px */
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 0.125rem 0.625rem var(--shadow-color);
            width: 100%;
            height: var(--header-height);
            margin-bottom: 0.9375rem; /* 15px */
            position: sticky;
            top: 0.3125rem; /* 5px */
            z-index: 10;
        }

        .header .profile-avatar {
            width: 2.5rem; /* 40px */
            height: 2.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #2D6EB6, #52C0BD);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem; /* 20px */
            font-weight: bold;
            color: white;
            box-shadow: 0 0 0.3125rem rgba(0, 201, 167, 0.5); /* 0 0 5px */
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .header .profile-avatar:hover {
            transform: scale(1.1);
        }

        .header .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .header .user-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* 8px */
            cursor: pointer;
        }

        .header .user-id-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            font-size: 0.75rem; /* 12px */
        }

        .header .user-id-label {
            color: var(--text-secondary);
        }

        .header .user-id-value {
            font-weight: bold;
        }

        .header .winix-title {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            font-size: 1.5rem; /* 24px */
            font-weight: bold;
            letter-spacing: 0.125rem; /* 2px */
            color: var(--text-color);
            text-shadow: 0 0 0.3125rem rgba(0, 201, 167, 0.3);
            animation: glow 11s infinite ease-in-out;
            text-align: center;
            flex-grow: 1;
        }

        @keyframes glow {
            0% { text-shadow: 0 0 0.3125rem rgba(0, 201, 167, 0.3); }
            72% { text-shadow: 0 0 0.9375rem rgba(0, 201, 167, 0.8), 0 0 1.875rem rgba(0, 201, 167, 0.5); }
            100% { text-shadow: 0 0 0.3125rem rgba(0, 201, 167, 0.3); }
        }

        .header .balance-container {
            display: flex;
            gap: 0.875rem; /* 14px */
            align-items: center;
        }

        .header .jeton-balance, .header .winix-balance {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header .jeton-balance .balance-value, .header .winix-balance .balance-value {
            font-size: 0.875rem; /* 14px */
            font-weight: bold;
        }

        .header .jeton-balance .balance-label, .header .winix-balance .balance-label {
            font-size: 0.75rem; /* 12px */
            font-weight: normal;
        }

        .header .jeton-icon {
            display: none;
        }

        .general-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.9375rem; /* 15px */
        }

        .general-title {
            font-size: 1.625rem; /* 26px */
            font-weight: bold;
            margin-bottom: 1.25rem; /* 20px */
            text-align: center;
            color: var(--text-color);
            text-shadow: 0 0 0.625rem rgba(0, 201, 167, 0.7); /* 0 0 10px */
            letter-spacing: 0.0625rem; /* 1px */
        }

        .general-card {
            width: 100%;
            background: var(--bg-card);
            border-radius: var(--card-border-radius);
            padding: 0.9375rem; /* 15px */
            margin-bottom: 0.9375rem; /* 15px */
            box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.3); /* 0 4px 10px */
        }

        .language-section {
            display: flex;
            flex-direction: column;
            gap: 0.625rem; /* 10px */
        }

        .language-title {
            font-size: 1.125rem; /* 18px */
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 0.625rem; /* 10px */
        }

        .language-options {
            display: flex;
            justify-content: space-between;
            gap: 0.625rem; /* 10px */
        }

        .language-option {
            flex: 1;
            text-align: center;
            padding: 0.75rem; /* 12px */
            background: var(--bg-item);
            border-radius: 0.9375rem; /* 15px */
            cursor: pointer;
            transition: all 0.3s ease;
            border: 0.0625rem solid transparent; /* 1px */
        }

        .language-option.active {
            background: linear-gradient(90deg, #2D6EB6, #52C0BD);
            box-shadow: 0 0 0.9375rem rgba(78, 181, 247, 0.5); /* 0 0 15px */
            border: 0.0625rem solid rgba(255, 255, 255, 0.2); /* 1px */
        }

        .language-option:hover:not(.active) {
            background: rgba(45, 110, 182, 0.3);
            border: 0.0625rem solid rgba(78, 181, 247, 0.3); /* 1px */
        }

        .language-icon {
            width: 1.875rem; /* 30px */
            height: 1.875rem;
            margin: 0 auto 0.3125rem; /* 0 auto 5px */
            border-radius: 50%;
            object-fit: cover;
            border: 0.0625rem solid rgba(255, 255, 255, 0.2); /* 1px */
        }

        .language-name {
            font-size: 0.875rem; /* 14px */
            font-weight: bold;
        }

        .profile-section {
            display: flex;
            flex-direction: column;
            gap: 0.9375rem; /* 15px */
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 0.9375rem; /* 15px */
            margin-bottom: 0.9375rem; /* 15px */
        }

        .profile-avatar {
            width: 4.375rem; /* 70px */
            height: 4.375rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #2D6EB6, #52C0BD);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem; /* 28px */
            font-weight: bold;
            color: white;
            box-shadow: 0 0 0.625rem rgba(0, 0, 0, 0.5); /* 0 0 10px */
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.125rem; /* 18px */
            font-weight: bold;
            margin-bottom: 0.3125rem; /* 5px */
        }

        .profile-id {
            font-size: 0.875rem; /* 14px */
            color: var(--text-secondary);
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0.9375rem; /* 12px 15px */
            background: var(--bg-item);
            border-radius: 0.9375rem; /* 15px */
            margin-bottom: 0.625rem; /* 10px */
        }

        .settings-title {
            font-size: 1rem; /* 16px */
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 3.125rem; /* 50px */
            height: 1.625rem; /* 26px */
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(120, 120, 120, 0.4);
            transition: .4s;
            border-radius: 2.125rem; /* 34px */
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 1.25rem; /* 20px */
            width: 1.25rem;
            left: 0.1875rem; /* 3px */
            bottom: 0.1875rem;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #00C9A7;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(1.5rem); /* 24px */
        }

        .action-button {
            width: 100%;
            background: linear-gradient(90deg, #2D6EB6, #52C0BD);
            border: none;
            border-radius: 1.5625rem; /* 25px */
            padding: 0.75rem; /* 12px */
            color: white;
            font-size: 1rem; /* 16px */
            font-weight: bold;
            margin-top: 0.9375rem; /* 15px */
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0.125rem 0.3125rem rgba(0, 0, 0, 0.3); /* 0 2px 5px */
        }

        .action-button:hover {
            transform: translateY(-0.125rem); /* -2px */
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.4); /* 0 4px 8px */
            background: linear-gradient(90deg, #3D7EC6, #62D0CD);
        }

        .document-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s;
            backdrop-filter: blur(3px);
        }

        .document-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @keyframes fadeIn {
            from {opacity: 0}
            to {opacity: 1}
        }

        .modal-content {
            background: linear-gradient(135deg, #1A1A2E, #0F3460);
            margin: 5% auto;
            padding: 1.25rem; /* 20px */
            border-radius: 1.25rem; /* 20px */
            width: 90%;
            max-width: 34.375rem; /* 550px */
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0.3125rem 1.25rem rgba(0, 0, 0, 0.5); /* 0 5px 20px */
            border: 0.0625rem solid rgba(0, 201, 167, 0.2); /* 1px */
            animation: bounceIn 0.4s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.9375rem; /* 15px */
            padding-bottom: 0.625rem; /* 10px */
            border-bottom: 0.0625rem solid rgba(255, 255, 255, 0.1); /* 1px */
        }

        .modal-title {
            font-size: 1.25rem; /* 20px */
            font-weight: bold;
            color: var(--text-color);
            text-shadow: 0 0 0.3125rem rgba(0, 201, 167, 0.3);
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 1.75rem; /* 28px */
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .close-modal:hover {
            color: #00C9A7;
        }

        .modal-body {
            font-size: 0.875rem; /* 14px */
            line-height: 1.6;
            color: #ddd;
        }

        .modal-body input {
            width: 100%;
            padding: 0.625rem 0.75rem; /* 10px 12px */
            margin-bottom: 0.9375rem; /* 15px */
            border-radius: 0.625rem; /* 10px */
            border: 0.0625rem solid rgba(0, 201, 167, 0.3); /* 1px */
            background: rgba(20, 30, 60, 0.6);
            color: var(--text-color);
            font-size: 0.9375rem; /* 15px */
            transition: all 0.3s ease;
        }

        .modal-body input:focus {
            outline: none;
            border-color: rgba(0, 201, 167, 0.8);
            box-shadow: 0 0 0.625rem rgba(0, 201, 167, 0.4);
        }

        .modal-body input.error {
            border-color: #f44336;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .modal-body label {
            display: block;
            margin-bottom: 0.3125rem; /* 5px */
            font-weight: bold;
            color: #f0f0f0;
        }

        .modal-footer {
            margin-top: 1.25rem; /* 20px */
            text-align: right;
        }

        .modal-button {
            background: linear-gradient(90deg, #2D6EB6, #52C0BD);
            border: none;
            border-radius: 1.25rem; /* 20px */
            padding: 0.625rem 1.25rem; /* 10px 20px */
            color: white;
            font-size: 1rem; /* 16px */
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0.1875rem 0.5rem rgba(0, 0, 0, 0.4);
        }

        .modal-button:hover {
            background: linear-gradient(90deg, #3D7EC6, #62D0CD);
            transform: translateY(-0.125rem); /* -2px */
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.5);
        }

        .modal-button:active {
            transform: scale(0.98);
        }

        .avatar-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.625rem; /* 10px */
            margin-top: 0.625rem; /* 10px */
            justify-content: center;
        }

        .avatar-option {
            width: 3.125rem; /* 50px */
            height: 3.125rem;
            border-radius: 50%;
            cursor: pointer;
            border: 0.125rem solid transparent; /* 2px */
            transition: all 0.3s ease;
            object-fit: cover;
        }

        .avatar-option.selected {
            border: 0.125rem solid #00C9A7; /* 2px */
            transform: scale(1.1);
        }

        .avatar-option:hover {
            border: 0.125rem solid rgba(0, 201, 167, 0.5); /* 2px */
            transform: scale(1.05);
        }

        .seed-modal-content {
            background: linear-gradient(135deg, #1A1A2E, #0F3460);
            margin: 5% auto;
            padding: 1.5625rem; /* 25px */
            border-radius: 1.25rem; /* 20px */
            width: 90%;
            max-width: 31.25rem; /* 500px */
            box-shadow: 0 0.3125rem 1.25rem rgba(0, 0, 0, 0.5); /* 0 5px 20px */
            position: relative;
            border: 0.0625rem solid rgba(0, 201, 167, 0.1); /* 1px */
        }

        .restore-card {
            width: 100%;
            background: var(--bg-card);
            border-radius: var(--card-border-radius);
            padding: 0.9375rem; /* 15px */
            box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.3); /* 0 4px 10px */
        }

        .restore-title {
            font-size: 1.5rem; /* 24px */
            font-weight: bold;
            margin-bottom: 0.9375rem; /* 15px */
            text-align: center;
            color: var(--text-color);
        }

        .restore-subtitle {
            font-size: 0.875rem; /* 14px */
            color: #ffc107;
            margin-bottom: 0.9375rem; /* 15px */
            text-align: center;
        }

        .words-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.625rem; /* 10px */
            margin-bottom: 1.25rem; /* 20px */
        }

        .word-cell {
            background: var(--bg-item);
            border-radius: 0.625rem; /* 10px */
            padding: 0.625rem; /* 10px */
            text-align: center;
        }

        .word-number {
            color: #6c757d;
            font-size: 0.75rem; /* 12px */
        }

        .word-value {
            color: var(--text-color);
            font-size: 0.875rem; /* 14px */
            font-weight: bold;
        }

        .copy-button {
            width: 100%;
            background: linear-gradient(90deg, #2D6EB6, #52C0BD);
            border: none;
            border-radius: 0.9375rem; /* 15px */
            padding: 0.625rem; /* 10px */
            color: white;
            font-size: 1rem; /* 16px */
            cursor: pointer;
            margin-bottom: 0.9375rem; /* 15px */
        }

        .copy-button:hover {
            background: linear-gradient(90deg, #3D7EC6, #62D0CD);
        }

        .seed-continue-button {
            width: 100%;
            background: linear-gradient(90deg, #2D6EB6, #52C0BD);
            border: none;
            border-radius: 0.75rem; /* 12px */
            padding: 0.9375rem; /* 15px */
            color: white;
            font-size: 1rem; /* 16px */
            font-weight: bold;
            cursor: pointer;
        }

        .seed-continue-button:hover {
            background: linear-gradient(90deg, #3D7EC6, #62D0CD);
        }

        .nav-bar {
            background: var(--primary-gradient);
            border-radius: 1.5625rem; /* 25px */
            padding: 0.5rem; /* 8px */
            display: flex;
            justify-content: space-around;
            width: 90%;
            max-width: 33.75rem; /* 540px */
            height: var(--nav-height);
            box-shadow: 0 0.25rem 0.75rem var(--shadow-color); /* 0 4px 12px */
            position: fixed;
            bottom: 1.875rem; /* 30px - підняли вгору на 20px з початкових 10px */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .nav-item {
            text-align: center;
            color: var(--text-color);
            font-size: 0.875rem; /* 14px */
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 20%;
            position: relative;
        }

        .nav-item .icon-wrapper {
            width: 3.75rem; /* 60px */
            height: 3.75rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem; /* 12px */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.3125rem; /* 5px */
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .nav-item.active .icon-wrapper {
            background: var(--bg-active);
            box-shadow: 0 0 0.9375rem var(--glow-color);
        }

        .nav-item img {
            width: 2.1875rem; /* 35px */
            height: 2.1875rem;
            display: block;
            filter: brightness(0) invert(1);
        }

        .nav-item.active img {
            filter: brightness(1.2) invert(1);
        }

        .nav-item:hover .icon-wrapper {
            transform: scale(1.1);
        }

        .bottom-buttons-container {
    display: flex;
    flex-direction: row;
    justify-content: space-around; /* Розподіл кнопок */
    gap: 1rem; /* Менший проміжок */
    align-items: flex-end;
    padding: 0.1rem;
    width: 100%;
    box-sizing: border-box;
    margin-top: 0.1rem;
    margin-bottom: 3rem; /* Відступ знизу */
}

        .bottom-button {
            width: 3.125rem; /* 50px */
            height: 3.125rem; /* 50px */
            background: linear-gradient(135deg, #2D6EB6, #52C0BD);
            border-radius: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.3); /* 0 4px 10px */
            cursor: pointer;
            transition: all 0.3s ease;
        }
        @media (max-width: 450px) {
            :root {
                --header-height: 3rem;
                --nav-height: 4rem;
        }

        }
        .bottom-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0.375rem 0.9375rem rgba(0, 0, 0, 0.4); /* 0 6px 15px */
        }

        .bottom-button img {
            width: 3.5rem; /* 24px */
            height: 3.5rem;
            filter: brightness(0) invert(1);
        }

        .button-icon {
            width: 1.5rem; /* 24px */
            height: 1.5rem;
            filter: brightness(0) invert(1);
        }

        .modal-scrollable-content {
            max-height: 60vh;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding-right: 0.5rem;
        }

        .modal-scrollable-content::-webkit-scrollbar {
            width: 0.375rem; /* 6px */
        }

        .modal-scrollable-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 0.625rem; /* 10px */
        }

        .modal-scrollable-content::-webkit-scrollbar-thumb {
            background-color: var(--secondary-color);
            border-radius: 0.625rem; /* 10px */
        }

        .modal-back-button {
            background: linear-gradient(90deg, #3D7EC6, #62D0CD);
            border: none;
            border-radius: 1.25rem; /* 20px */
            padding: 0.625rem 1.25rem; /* 10px 20px */
            color: white;
            font-size: 1rem; /* 16px */
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0.1875rem 0.5rem rgba(0, 0, 0, 0.4);
            margin-top: 1rem;
        }

        .modal-back-button:hover {
            transform: translateY(-0.125rem); /* -2px */
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.5);
        }

        #error-msg {
            color: #f44336;
            background-color: rgba(244, 67, 54, 0.1);
            border-left: 3px solid #f44336;
            padding: 8px 12px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }

        .spinner-inner {
            width: 3.125rem; /* 50px */
            height: 3.125rem;
            border: 0.3125rem solid rgba(0, 201, 167, 0.3); /* 5px */
            border-radius: 50%;
            border-top: 0.3125rem solid #00C9A7; /* 5px */
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast-message {
            position: fixed;
            top: 1.25rem; /* 20px */
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #1A1A2E, #0F3460);
            color: #ffffff;
            padding: 0.75rem 1.5rem; /* 12px 24px */
            border-radius: 12px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 1px solid rgba(78, 181, 247, 0.2);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.9375rem; /* 15px */
            display: flex;
            align-items: center;
            max-width: 350px;
            width: 90%;
        }

        .toast-message.success {
            background: linear-gradient(135deg, #0F3460, #006064);
            border: 1px solid rgba(0, 201, 167, 0.5);
        }

        .toast-message.error {
            background: linear-gradient(135deg, #2E0B0B, #860000);
            border: 1px solid rgba(255, 82, 82, 0.5);
        }

        .toast-message::after {
            content: '×';
            color: #4eb5f7;
            margin-left: 10px;
            cursor: pointer;
            font-size: 20px;
        }

        .toast-message.show {
            opacity: 1;
            transform: translate(-50%, 0.625rem); /* -50%, 10px */
        }

        @media (max-width: 450px) {
            :root {
                --header-height: 3rem; /* 48px */
                --nav-height: 4rem; /* 64px */
            }

            .header .profile-avatar {
                width: 2.1875rem; /* 35px */
                height: 2.1875rem;
                font-size: 1.125rem; /* 18px */
            }

            .header .user-id-container {
                font-size: 0.6875rem; /* 11px */
            }

            .header .winix-title {
                font-size: 1.25rem; /* 20px */
            }

            .language-options {
                flex-wrap: wrap;
            }

            .language-option {
                padding: 0.5rem; /* 8px */
            }

            .profile-avatar {
                width: 3.75rem; /* 60px */
                height: 3.75rem;
            }

            .nav-item .icon-wrapper {
                width: 3.125rem; /* 50px */
                height: 3.125rem;
            }

            .nav-item img {
                width: 1.875rem; /* 30px */
                height: 1.875rem;
            }
        }

        @media (max-width: 350px) {
            .header .user-id-container {
                display: none;
            }

            .header .jeton-balance {
                margin-left: 0;
            }

            .header .balance-label {
                font-size: 0.6875rem; /* 11px */
            }

            .profile-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .profile-info {
                text-align: center;
            }

            .words-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            body {
                background: linear-gradient(135deg, #141e30, #243b55);
            }

            .container {
                box-shadow: 0 0.625rem 1.875rem rgba(0, 0, 0, 0.3); /* 0 10px 30px */
                margin: 1.25rem auto; /* 20px */
                height: calc(100vh - 2.5rem); /* calc(100vh - 40px) */
                border-radius: 1.25rem; /* 20px */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-profile" id="profile-link">
                <div class="profile-avatar" id="profile-avatar">W</div>
                <div class="user-id-container">
                    <span class="user-id-label">ID:</span>
                    <span class="user-id-value" id="user-id"></span>
                </div>
            </div>
            <div class="winix-title">WINIX</div>
            <div class="balance-container">
                <div class="jeton-balance">
                    <div id="user-coins" class="balance-value">250</div>
                    <div class="balance-label" data-lang-key="coins">Жетони</div>
                </div>
                <div class="winix-balance">
                    <div id="user-tokens" class="balance-value">294562.16</div>
                    <div class="balance-label">$WINIX</div>
                </div>
            </div>
        </div>

        <div class="general-container">
            <div class="general-title" data-lang-key="settings">Налаштування</div>

            <div class="general-card">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar-large">W</div>
                        <div class="profile-info">
                            <div class="profile-name" id="profile-name">WINIX User</div>
                            <div class="profile-id"><span data-lang-key="user_id">ID:</span> <span id="user-id-profile">12345678</span></div>
                        </div>
                    </div>
                    <button class="action-button" id="edit-profile" data-lang-key="edit_profile">Редагувати профіль</button>
                </div>
            </div>

            <div class="general-card">
                <div class="language-section">
                    <div class="language-title" data-lang-key="language_selection">Вибір мови</div>
                    <div class="language-options">
                        <div class="language-option active" data-lang="uk">
                            <img src="assets/ua_flag.jpg" alt="Українська" class="language-icon" onerror="this.src='https://via.placeholder.com/30?text=UA'">
                            <div class="language-name" data-lang-key="language_uk">Українська</div>
                        </div>
                        <div class="language-option" data-lang="en">
                            <img src="assets/en_flag.jpg" alt="English" class="language-icon" onerror="this.src='https://via.placeholder.com/30?text=EN'">
                            <div class="language-name" data-lang-key="language_en">English</div>
                        </div>
                        <div class="language-option" data-lang="ru">
                            <img src="assets/ru_flag.jpg" alt="Русский" class="language-icon" onerror="this.src='https://via.placeholder.com/30?text=RU'">
                            <div class="language-name" data-lang-key="language_ru">Русский</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="general-card">
                <div class="language-title" data-lang-key="app_settings">Налаштування додатку</div>
                <div class="settings-item">
                    <div class="settings-title" data-lang-key="notifications">Сповіщення</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifications-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="general-card">
                <div class="language-title" data-lang-key="security">Безпека</div>
                <button class="action-button" id="show-seed-phrase" data-lang-key="show_seed">Показати SID фразу</button>
            </div>

            <div class="bottom-buttons-container">
                <a href="https://t.me/Winix_Support" target="_blank" class="bottom-button" id="help-button" title="Підтримка">
                    <img src="assets/support-icon.png" alt="Підтримка" class="button-icon">
                </a>
                <div class="bottom-button" id="license-button" title="Ліцензія">
                    <img src="assets/license-icon.png" alt="Ліцензія" class="button-icon" onerror="this.src='https://via.placeholder.com/24?text=L'">
                </div>
                <div class="bottom-button" id="agreement-button" title="Угода користувача">
                    <img src="assets/agreement-icon.png" alt="Угода" class="button-icon" onerror="this.src='https://via.placeholder.com/24?text=A'">
                </div>
            </div>
        </div>

        <div class="nav-bar">
            <div class="nav-item" data-section="home"><div class="icon-wrapper"><img src="assets/home-icon.png" alt="Головна"></div><span data-lang-key="home">Головна</span></div>
            <div class="nav-item" data-section="earn"><div class="icon-wrapper"><img src="assets/earn-icon.png" alt="Заробіток"></div><span data-lang-key="earn">Заробіток</span></div>
            <div class="nav-item" data-section="referrals"><div class="icon-wrapper"><img src="assets/referrals-icon.png" alt="Реферали"></div><span data-lang-key="referrals">Реферали</span></div>
            <div class="nav-item" data-section="wallet"><div class="icon-wrapper"><img src="assets/wallet-icon.png" alt="Гаманець"></div><span data-lang-key="wallet">Гаманець</span></div>
            <div class="nav-item active" data-section="general"><div class="icon-wrapper"><img src="assets/general-icon.png" alt="Налаштування"></div><span data-lang-key="General">Налаштування</span></div>
        </div>
    </div>

    <script>
        // Словник для перекладів
        const translations = {
            "WINIX": "WINIX",
            "$WINIX": "$WINIX",
            "home": "Головна",
            "earn": "Заробіток",
            "referrals": "Реферали",
            "wallet": "Гаманець",
            "profile": "Профіль",
            "settings": "Налаштування",
            "coins": "Жетони",
            "days": "днів",
            "hours": "годин",
            "minutes": "хвилин",
            "edit_profile": "Редагувати профіль",
            "edit_profile_title": "Редагування профілю",
            "username": "Ім'я користувача",
            "new_password": "Новий пароль",
            "password_placeholder": "Залиште порожнім, щоб не змінювати",
            "confirm_password": "Підтвердження паролю",
            "confirm_password_placeholder": "Повторіть новий пароль",
            "upload_avatar": "Завантажити аватар",
            "select_avatar": "Обрати аватар",
            "btn_save": "Зберегти",
            "profile_updated": "Профіль успішно оновлено",
            "enter_username": "Введіть ім'я користувача",
            "passwords_dont_match": "Паролі не співпадають",
            "min_8_chars": "Пароль має містити не менше 8 символів",
            "min_5_letters": "Пароль має містити не менше 5 літер",
            "current_password": "Поточний пароль",
            "current_password_placeholder": "Введіть поточний пароль для зміни",
            "enter_current_password": "Введіть поточний пароль для зміни",
            "wrong_current_password": "Неправильний поточний пароль",
            "set_new_password": "Встановити пароль",
            "set_password_placeholder": "Пароль для захисту акаунту",
            "language_selection": "Вибір мови",
            "language_uk": "Українська",
            "language_en": "English",
            "language_ru": "Русский",
            "app_settings": "Налаштування додатку",
            "notifications": "Сповіщення",
            "security": "Безпека",
            "settings_saved": "Налаштування збережено",
            "settings_error": "Помилка збереження",
            "show_seed": "Показати SID фразу",
            "set_password": "Встановлення паролю",
            "password_requirements": "Пароль має містити не менше 8 символів, включаючи 5 літер",
            "password": "Пароль",
            "confirm": "Підтвердження",
            "enter_password": "Введіть пароль",
            "your_password": "Ваш пароль",
            "check": "Перевірити",
            "wrong_password": "Невірний пароль",
            "seed_phrase": "SID фраза",
            "your_seed_phrase": "Ваша SID фраза",
            "save_seed": "Збережіть цю фразу в надійному місці",
            "copy": "Копіювати",
            "copied": "Скопійовано",
            "copy_error": "Помилка копіювання",
            "done": "Готово",
            "license_agreement": "Ліцензійна угода",
            "user_agreement": "Угода користувача",
            "back": "Назад",
            "contact_support": "Зв'язок з підтримкою",
            "navigation_error": "Помилка навігації",
            "user_id": "ID:",
            "password_required": "Потрібно ввести пароль",
            "password_invalid": "Невірний формат пароля",
            "avatar_load_error": "Помилка завантаження аватара"
        };

        function getText(key, defaultText = key) {
            return translations[key] || defaultText;
        }

        let tg;
        try {
            tg = window.Telegram ? window.Telegram.WebApp : null;
            if (tg) {
                console.log("Telegram WebApp API успішно ініціалізовано");
                tg.ready();
                tg.expand();
                tg.onEvent('themeChanged', updateThemeColors);
                tg.onEvent('viewportChanged', adjustLayout);
            } else {
                console.error("Telegram WebApp API недоступний");
            }
        } catch (error) {
            console.error("Помилка при ініціалізації Telegram WebApp API:", error.message);
            tg = null;
        }

        function updateThemeColors() {
            if (tg && tg.colorScheme) {
                document.body.setAttribute('data-theme', tg.colorScheme);
            }
        }

        function adjustLayout() {
            const isSmallScreen = window.innerWidth <= 450;
            const container = document.querySelector('.container');
            if (isSmallScreen) {
                container.classList.add('small-screen');
            } else {
                container.classList.remove('small-screen');
            }
        }

        function getTranslation(key, defaultText) {
            if (window.WinixLanguage && typeof window.WinixLanguage.getText === 'function') {
                try {
                    return window.WinixLanguage.getText(key) || defaultText || key;
                } catch (error) {
                    console.error(`Помилка отримання перекладу для ключа ${key}:`, error);
                    return defaultText || key;
                }
            }
            return getText(key, defaultText || key);
        }

        function navigateToPage(page) {
            try {
                if (window._isNavigating) {
                    console.log('Навігація вже в процесі');
                    return;
                }

                window._isNavigating = true;

                const spinner = document.getElementById('loading-spinner');
                if (spinner) {
                    spinner.style.display = 'flex';
                }

                let tokens = 0;
                let coins = 0;

                if (window.WinixCore && window.WinixCore.Balance) {
                    tokens = window.WinixCore.Balance.getTokens();
                    coins = window.WinixCore.Balance.getCoins();
                } else if (window.rewardSystem) {
                    if (typeof window.rewardSystem.getTokens === 'function') {
                        tokens = window.rewardSystem.getTokens();
                    }
                    if (typeof window.rewardSystem.getCoins === 'function') {
                        coins = window.rewardSystem.getCoins();
                    }
                } else if (window.balanceSystem) {
                    if (typeof window.balanceSystem.getTokens === 'function') {
                        tokens = window.balanceSystem.getTokens();
                    }
                    if (typeof window.balanceSystem.getCoins === 'function') {
                        coins = window.balanceSystem.getCoins();
                    }
                } else {
                    tokens = parseFloat(localStorage.getItem('userTokens') || '0');
                    coins = parseFloat(localStorage.getItem('userCoins') || '0');
                }

                sessionStorage.setItem('lastBalance', tokens.toString());
                sessionStorage.setItem('lastCoins', coins.toString());
                sessionStorage.setItem('navigationTime', Date.now().toString());

                const currentPage = window.location.pathname.split('/').pop();
                if (currentPage === page) {
                    console.log('Вже на цій сторінці');
                    if (spinner) {
                        spinner.style.display = 'none';
                    }
                    window._isNavigating = false;
                    return;
                }

                setTimeout(() => {
                    window.location.href = page;
                }, 100);
            } catch (error) {
                console.error('Помилка навігації:', error);
                window._isNavigating = false;

                const spinner = document.getElementById('loading-spinner');
                if (spinner) {
                    spinner.style.display = 'none';
                }

                showToast(getTranslation('navigation_error', 'Помилка навігації'), true);
            }
        }
/**
 * Функція для навігації між сторінками
 * @param {string} page - URL сторінки, на яку потрібно перейти
 */
function navigateTo(page) {
    try {
        if (window._isNavigating) {
            console.log('Навігація вже в процесі');
            return;
        }

        window._isNavigating = true;

        // Показуємо індикатор завантаження
        const spinner = document.getElementById('loading-spinner');
        if (spinner) spinner.style.display = 'flex';

        // Зберігаємо поточний баланс для порівняння після навігації
        const currentTokens = parseFloat(document.getElementById('user-tokens').textContent || '0');
        const currentCoins = parseFloat(document.getElementById('user-coins').textContent || '0');
        sessionStorage.setItem('lastBalance', currentTokens.toString());
        sessionStorage.setItem('lastCoins', currentCoins.toString());
        sessionStorage.setItem('navigationTime', Date.now().toString());

        // Запитуємо поточну сторінку
        const currentPage = window.location.pathname.split('/').pop();
        if (currentPage === page) {
            console.log('Вже на цій сторінці');
            if (spinner) spinner.style.display = 'none';
            window._isNavigating = false;
            return;
        }

        // Переходимо на нову сторінку
        setTimeout(() => {
            window.location.href = page;
        }, 100);
    } catch (error) {
        console.error('Помилка навігації:', error);
        window._isNavigating = false;

        const spinner = document.getElementById('loading-spinner');
        if (spinner) spinner.style.display = 'none';

        showToast("Помилка навігації", true);
    }
}
        function loadUserAvatar() {
            const headerAvatar = document.getElementById('profile-avatar');
            const profileAvatar = document.getElementById('profile-avatar-large');
            const headerUserId = document.getElementById('user-id');
            const profileUserId = document.getElementById('user-id-profile');

            const username = localStorage.getItem('username') || 'WINIX User';
            const userId = localStorage.getItem('userId') || '12345678';
            const avatarSrc = localStorage.getItem('userAvatarSrc');
            const avatarId = localStorage.getItem('selectedAvatarId');

            document.getElementById('profile-name').textContent = username;

            if (headerUserId) headerUserId.textContent = userId;
            if (profileUserId) profileUserId.textContent = userId;

            function setAvatar(element) {
                if (!element) return;
                element.innerHTML = '';
                if (avatarSrc) {
                    const img = new Image();
                    img.src = avatarSrc;
                    img.alt = username;
                    img.onerror = () => {
                        console.log('Помилка завантаження аватара, використовуємо текст');
                        element.textContent = username[0].toUpperCase();
                    };
                    element.appendChild(img);
                } else if (avatarId) {
                    const src = localStorage.getItem(`${avatarId}Src`) || `assets/avatar${avatarId}.png` || `https://via.placeholder.com/50?text=${avatarId}`;
                    const img = new Image();
                    img.src = src;
                    img.alt = username;
                    img.onerror = () => {
                        console.log('Помилка завантаження аватара, використовуємо запасний варіант');
                        element.textContent = username[0].toUpperCase();
                    };
                    element.appendChild(img);
                } else {
                    element.textContent = username[0].toUpperCase();
                }
            }

            setAvatar(headerAvatar);
            setAvatar(profileAvatar);
        }

        function updateBalanceDisplay() {
            try {
                let tokens = parseFloat(localStorage.getItem('userTokens') || '294562.16');
                let coins = parseFloat(localStorage.getItem('userCoins') || '250');
                document.getElementById('user-tokens').textContent = tokens.toFixed(2);
                document.getElementById('user-coins').textContent = coins.toFixed(0);
            } catch (error) {
                console.error('Error updating balance:', error);
            }
        }

        function hashPassword(password) {
            let hash = 0;
            if (password.length === 0) return hash.toString();
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString() + "winix";
        }

        function validatePassword(password) {
            if (!password || password.length < 8)
                return { valid: false, message: getTranslation('min_8_chars', 'Пароль має містити не менше 8 символів') };
            if ((password.match(/[a-zA-Zа-яА-ЯіїєґІЇЄҐ]/g) || []).length < 5)
                return { valid: false, message: getTranslation('min_5_letters', 'Пароль має містити не менше 5 літер') };
            return { valid: true };
        }

        /**
 * Функція для показу модального вікна редагування профілю
 */
function showEditProfileModal() {
    const currentUsername = localStorage.getItem('username') || 'WINIX User';
    const savedPasswordHash = localStorage.getItem('passwordHash');
    const savedSeedHash = localStorage.getItem('seedPhrasePasswordHash');
    const hasPassword = savedPasswordHash || savedSeedHash;

    const passwordFieldLabel = hasPassword ? getTranslation('current_password', 'Поточний пароль') : getTranslation('set_new_password', 'Встановити пароль');
    const passwordFieldPlaceholder = hasPassword ? getTranslation('current_password_placeholder', 'Введіть поточний пароль для зміни') : getTranslation('set_password_placeholder', 'Пароль для захисту акаунту');

    // Видаляємо попередні модальні вікна, якщо вони є
    document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

    // Створюємо нове модальне вікно
    const modal = document.createElement('div');
    modal.className = 'document-modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">${getTranslation('edit_profile_title', 'Редагування профілю')}</div>
                <span class="close-modal">×</span>
            </div>
            <div class="modal-body">
                <div class="settings-item">
                    <label>${getTranslation('username', "Ім'я користувача")}</label>
                    <input type="text" id="edit-username" value="${currentUsername}">
                </div>
                <div class="settings-item">
                    <label>${passwordFieldLabel}</label>
                    <input type="password" id="edit-current-password" placeholder="${passwordFieldPlaceholder}">
                </div>
                <div class="settings-item">
                    <label>${getTranslation('new_password', 'Новий пароль')}</label>
                    <input type="password" id="edit-password" placeholder="${getTranslation('password_placeholder', 'Залиште порожнім, щоб не змінювати')}">
                </div>
                <div class="settings-item">
                    <label>${getTranslation('confirm_password', 'Підтвердження паролю')}</label>
                    <input type="password" id="edit-password-confirm" placeholder="${getTranslation('confirm_password_placeholder', 'Повторіть новий пароль')}">
                </div>
                <div class="settings-item">
                    <label>${getTranslation('upload_avatar', 'Завантажити аватар')}</label>
                    <input type="file" id="avatar-upload" accept="image/*">
                </div>
                <div class="settings-item">
                    <label>${getTranslation('select_avatar', 'Обрати аватар')}</label>
                    <div class="avatar-options">
                        <img src="assets/avatar1.png" class="avatar-option" data-id="1" onerror="this.src='https://via.placeholder.com/50?text=1'">
                        <img src="assets/avatar2.png" class="avatar-option" data-id="2" onerror="this.src='https://via.placeholder.com/50?text=2'">
                        <img src="assets/avatar3.png" class="avatar-option" data-id="3" onerror="this.src='https://via.placeholder.com/50?text=3'">
                        <img src="assets/avatar4.png" class="avatar-option" data-id="4" onerror="this.src='https://via.placeholder.com/50?text=4'">
                        <img src="assets/avatar5.png" class="avatar-option" data-id="5" onerror="this.src='https://via.placeholder.com/50?text=5'">
                        <img src="assets/avatar6.png" class="avatar-option" data-id="6" onerror="this.src='https://via.placeholder.com/50?text=6'">
                        <img src="assets/avatar7.png" class="avatar-option" data-id="7" onerror="this.src='https://via.placeholder.com/50?text=7'">
                        <img src="assets/avatar8.png" class="avatar-option" data-id="8" onerror="this.src='https://via.placeholder.com/50?text=8'">
                        <img src="assets/avatar9.png" class="avatar-option" data-id="9" onerror="this.src='https://via.placeholder.com/50?text=9'">
                        <img src="assets/avatar10.png" class="avatar-option" data-id="10" onerror="this.src='https://via.placeholder.com/50?text=10'">
                        <img src="assets/avatar11.png" class="avatar-option" data-id="11" onerror="this.src='https://via.placeholder.com/50?text=11'">
                        <img src="assets/avatar12.png" class="avatar-option" data-id="12" onerror="this.src='https://via.placeholder.com/50?text=12'">
                        <img src="assets/avatar13.png" class="avatar-option" data-id="13" onerror="this.src='https://via.placeholder.com/50?text=13'">
                    </div>
                </div>
                <div id="error-msg"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button" id="save-profile">${getTranslation('btn_save', 'Зберегти')}</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // Позначаємо активний аватар
    const avatarOptions = modal.querySelectorAll('.avatar-option');
    const selectedAvatarId = localStorage.getItem('selectedAvatarId');
    avatarOptions.forEach(opt => {
        if (opt.dataset.id === selectedAvatarId) opt.classList.add('selected');
        opt.onclick = () => {
            avatarOptions.forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
        };
    });

    // Додаємо обробник для кнопки збереження
    const saveBtn = modal.querySelector('#save-profile');
    saveBtn.onclick = () => {
        const username = modal.querySelector('#edit-username').value.trim();
        const password = modal.querySelector('#edit-password').value;
        const confirm = modal.querySelector('#edit-password-confirm').value;
        const currentPassword = modal.querySelector('#edit-current-password').value;
        const uploadedAvatar = modal.querySelector('#avatar-upload').files[0];
        const selectedAvatar = modal.querySelector('.avatar-option.selected');
        const error = modal.querySelector('#error-msg');

        error.textContent = '';

        // Перевірка імені користувача
        if (!username) {
            error.textContent = getTranslation('enter_username', "Введіть ім'я користувача");
            modal.querySelector('#edit-username').classList.add('error');
            return;
        }

        // Перевірка паролів
        if (password) {
            if (hasPassword) {
                if (!currentPassword) {
                    error.textContent = getTranslation('enter_current_password', 'Введіть поточний пароль для зміни');
                    modal.querySelector('#edit-current-password').classList.add('error');
                    return;
                }

                const currentPasswordHash = hashPassword(currentPassword);
                if ((savedPasswordHash && currentPasswordHash !== savedPasswordHash) &&
                    (savedSeedHash && currentPasswordHash !== savedSeedHash)) {
                    error.textContent = getTranslation('wrong_current_password', 'Неправильний поточний пароль');
                    modal.querySelector('#edit-current-password').classList.add('error');
                    return;
                }
            }

            if (password !== confirm) {
                error.textContent = getTranslation('passwords_dont_match', 'Паролі не співпадають');
                modal.querySelector('#edit-password-confirm').classList.add('error');
                return;
            }

            const validation = validatePassword(password);
            if (!validation.valid) {
                error.textContent = validation.message;
                modal.querySelector('#edit-password').classList.add('error');
                return;
            }
        } else if (currentPassword && !hasPassword) {
            const validation = validatePassword(currentPassword);
            if (!validation.valid) {
                error.textContent = validation.message;
                modal.querySelector('#edit-current-password').classList.add('error');
                return;
            }
        }

        // Збереження даних
        const settings = {
            username: username
        };

        // Якщо вибрано новий аватар з галереї
        if (selectedAvatar) {
            settings.avatar_id = selectedAvatar.dataset.id;
        }

        // Показуємо індикатор завантаження
        const spinner = document.getElementById('loading-spinner');
        if (spinner) spinner.style.display = 'flex';

        // Оновлюємо профіль на сервері
        saveUserSettings(settings);

        // Якщо є новий пароль, оновлюємо його окремим запитом
        if (password) {
            updateUserPassword(password, hasPassword ? currentPassword : null);
        } else if (currentPassword && !hasPassword) {
            updateUserPassword(currentPassword);
        }

        // Якщо завантажено новий аватар, обробляємо його
        if (uploadedAvatar) {
            const reader = new FileReader();
            reader.onload = () => {
                const avatarSrc = reader.result;
                localStorage.setItem('userAvatarSrc', avatarSrc);
                localStorage.removeItem('selectedAvatarId');
                loadUserAvatar();

                // Надсилаємо запит на сервер для збереження аватара
                // Тут може бути потрібен спеціальний ендпоінт для завантаження файлів
                // Наразі просто зберігаємо в localStorage
            };
            reader.readAsDataURL(uploadedAvatar);
        } else if (selectedAvatar) {
            const avatarId = selectedAvatar.dataset.id;
            localStorage.setItem('selectedAvatarId', avatarId);
            localStorage.setItem(`${avatarId}Src`, selectedAvatar.src);
            localStorage.removeItem('userAvatarSrc');

            // Оновлюємо налаштування з аватаром
            saveUserSettings({
                avatar_id: avatarId
            });

            loadUserAvatar();
        }

        // Закриваємо модальне вікно
        modal.remove();
        showToast(getTranslation('profile_updated', 'Профіль успішно оновлено'), false);

        // Ховаємо індикатор завантаження
        if (spinner) spinner.style.display = 'none';
    };

    // Додаємо обробники подій для полів вводу
    modal.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('error');
        });
    });

    // Додаємо обробники для закриття модального вікна
    modal.querySelector('.close-modal').onclick = () => modal.remove();
    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
}

/**
 * Функція для показу модального вікна SID фрази
 */
function showSeedPhrase() {
    console.log("Виклик функції showSeedPhrase");

    // Отримуємо ID користувача
    const userId = localStorage.getItem('userId') || '12345678';

    // Показуємо індикатор завантаження
    const spinner = document.getElementById('loading-spinner');
    if (spinner) spinner.style.display = 'flex';

    // Робимо запит до сервера для отримання seed-фрази
    fetch(`/api/user/${userId}/seed-phrase`)
        .then(response => {
            if (!response.ok) throw new Error(`Помилка HTTP: ${response.status}`);
            return response.json();
        })
        .then(data => {
            if (data.status === 'success' && data.data && data.data.seed_phrase) {
                // Розбиваємо фразу на окремі слова
                const phrase = data.data.seed_phrase.split(' ');

                // Створюємо та показуємо модальне вікно
                showSeedPhraseModal(phrase);
            } else {
                console.warn("Отримано некоректні дані SID-фрази:", data);
                showToast("Помилка отримання SID-фрази. Спробуйте пізніше.", true);
            }
        })
        .catch(error => {
            console.error("❌ Помилка отримання SID-фрази:", error);
            showToast("Помилка з'єднання з сервером", true);
        })
        .finally(() => {
            // Ховаємо індикатор завантаження
            if (spinner) spinner.style.display = 'none';
        });
}

/**
 * Функція для показу модального вікна з SID фразою
 * @param {Array} phrase - Масив слів SID фрази
 */
function showSeedPhraseModal(phrase) {
    // Видаляємо попередні модальні вікна, якщо вони є
    document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

    // Створюємо нове модальне вікно
    const modal = document.createElement('div');
    modal.className = 'document-modal show';
    modal.innerHTML = `
        <div class="seed-modal-content">
            <div class="modal-header">
                <div class="modal-title">${getTranslation('seed_phrase', 'SID фраза')}</div>
                <span class="close-modal">×</span>
            </div>
            <div class="modal-body">
                <div class="restore-card">
                    <div class="restore-title">${getTranslation('your_seed_phrase', 'Ваша SID фраза')}</div>
                    <div class="restore-subtitle">${getTranslation('save_seed', 'Збережіть цю фразу в надійному місці')}</div>
                    <button class="copy-button">${getTranslation('copy', 'Копіювати')}</button>
                    <div class="words-grid">
                        ${phrase.map((word, i) => `
                            <div class="word-cell">
                                <div class="word-number">${i + 1}.</div>
                                <div class="word-value">${word}</div>
                            </div>
                        `).join('')}
                    </div>
                    <button class="seed-continue-button">${getTranslation('done', 'Готово')}</button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // Додаємо обробники подій
    modal.querySelector('.close-modal').onclick = () => modal.remove();
    modal.querySelector('.copy-button').onclick = () => {
        navigator.clipboard.writeText(phrase.join(' '))
            .then(() => showToast(getTranslation('copied', 'Скопійовано')))
            .catch(() => showToast(getTranslation('copy_error', 'Помилка копіювання'), true));
    };
    modal.querySelector('.seed-continue-button').onclick = () => {
        localStorage.setItem('seedPhraseViewed', 'true');
        modal.remove();
    };
    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
}

/**
 * Функція для показу модального вікна введення пароля
 * @param {Function} callback - Функція, яка буде викликана після успішного введення пароля
 */
function showEnterPasswordModal(callback) {
    // Видаляємо попередні модальні вікна, якщо вони є
    document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

    // Створюємо нове модальне вікно
    const modal = document.createElement('div');
    modal.className = 'document-modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">${getTranslation('enter_password', 'Введіть пароль')}</div>
                <span class="close-modal">×</span>
            </div>
            <div class="modal-body">
                <input type="password" id="enter-password" placeholder="${getTranslation('your_password', 'Ваш пароль')}">
                <div id="error-msg"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button" id="check-password">${getTranslation('check', 'Перевірити')}</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // Додаємо обробники подій
    const checkBtn = modal.querySelector('#check-password');
    checkBtn.onclick = () => {
        const pwd = modal.querySelector('#enter-password').value;
        const error = modal.querySelector('#error-msg');

        // Перевіряємо пароль
        const savedPassHash = localStorage.getItem('passwordHash');
        const savedSeedHash = localStorage.getItem('seedPhrasePasswordHash');
        const inputHash = hashPassword(pwd);

        if (inputHash === savedPassHash || inputHash === savedSeedHash) {
            modal.remove();
            if (typeof callback === 'function') {
                callback(pwd);
            }
        } else {
            error.textContent = getTranslation('wrong_password', 'Невірний пароль');
        }
    };

    // Додаємо обробники для закриття модального вікна
    modal.querySelector('.close-modal').onclick = () => modal.remove();
    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

    // Додаємо обробник для Enter
    modal.querySelector('#enter-password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            checkBtn.click();
        }
    });
}

/**
 * Функція для показу модального вікна встановлення пароля
 * @param {Function} callback - Функція, яка буде викликана після успішного встановлення пароля
 */
function showSetPasswordModal(callback) {
    // Видаляємо попередні модальні вікна, якщо вони є
    document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

    // Створюємо нове модальне вікно
    const modal = document.createElement('div');
    modal.className = 'document-modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">${getTranslation('set_password', 'Встановлення паролю')}</div>
                <span class="close-modal">×</span>
            </div>
            <div class="modal-body">
                <p>${getTranslation('password_requirements', 'Пароль має містити не менше 8 символів, включаючи 5 літер')}</p>
                <input type="password" id="new-password" placeholder="${getTranslation('password', 'Пароль')}">
                <input type="password" id="confirm-password" placeholder="${getTranslation('confirm', 'Підтвердження')}">
                <div id="error-msg"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button" id="save-password">${getTranslation('btn_save', 'Зберегти')}</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // Додаємо обробники подій
    const saveBtn = modal.querySelector('#save-password');
    saveBtn.onclick = () => {
        const pwd = modal.querySelector('#new-password').value;
        const confirm = modal.querySelector('#confirm-password').value;
        const error = modal.querySelector('#error-msg');

        // Перевіряємо, чи паролі співпадають
        if (pwd !== confirm) {
            error.textContent = getTranslation('passwords_dont_match', 'Паролі не співпадають');
            return;
        }

        // Перевіряємо валідність пароля
        const validation = validatePassword(pwd);
        if (!validation.valid) {
            error.textContent = validation.message;
            return;
        }

        // Зберігаємо пароль
        updateUserPassword(pwd);

        // Закриваємо модальне вікно
        modal.remove();

        // Викликаємо колбек, якщо він є
        if (typeof callback === 'function') {
            callback(pwd);
        }
    };

    // Додаємо обробники для закриття модального вікна
    modal.querySelector('.close-modal').onclick = () => modal.remove();
    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
}

/**
 * Функція для обробки показу SID фрази
 */
function handleShowSeedPhrase() {
    console.log("Виклик функції handleShowSeedPhrase");
    try {
        const savedPassHash = localStorage.getItem('passwordHash');
        const savedSeedHash = localStorage.getItem('seedPhrasePasswordHash');
        const hasPassword = savedPassHash || savedSeedHash;

        console.log("Наявність паролю:", !!hasPassword);

        if (!hasPassword) {
            console.log("Пароль відсутній, показуємо модалку встановлення паролю");
            showSetPasswordModal(function(password) {
                console.log("Пароль встановлено, показуємо SID фразу");
                showSeedPhrase();
            });
        } else {
            console.log("Пароль наявний, показуємо модалку введення паролю");
            showEnterPasswordModal(function(password) {
                console.log("Пароль підтверджено, показуємо SID фразу");
                showSeedPhrase();
            });
        }
    } catch (error) {
        console.error("Помилка при обробці показу SID фрази:", error);
        showToast("Виникла помилка при спробі показати SID фразу", true);
    }
}

/**
 * Функція для показу модального вікна з ліцензійною угодою
 */
function showLicenseModal() {
    // Видаляємо попередні модальні вікна, якщо вони є
    document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

    // Створюємо нове модальне вікно
    const modal = document.createElement('div');
    modal.className = 'document-modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ліцензійна угода WINIX</div>
                <span class="close-modal">×</span>
            </div>
            <div class="modal-scrollable-content">
                <p>Версія 1.0, Березень 2025</p>
                <br>
                <p>Ця ліцензійна угода ("Угода") укладена між WINIX ("Ліцензіар") та Вами ("Ліцензіат").</p>
                <br>
                <p>1. НАДАННЯ ЛІЦЕНЗІЇ</p>
                <p>Ліцензіар надає Ліцензіату невиключну ліцензію на використання програмного забезпечення WINIX ("Програмне забезпечення") відповідно до умов цієї Угоди.</p>
                <br>
                <p>2. ОБМЕЖЕННЯ</p>
                <p>Ліцензіат не має права:</p>
                <p>- Копіювати або розповсюджувати Програмне забезпечення</p>
                <p>- Модифікувати, декомпілювати або дизасемблювати Програмне забезпечення</p>
                <p>- Використовувати Програмне забезпечення для незаконних цілей</p>
                <br>
                <p>3. ПРАВА ВЛАСНОСТІ</p>
                <p>Програмне забезпечення є власністю Ліцензіара та захищено законами про інтелектуальну власність.</p>
                <br>
                <p>4. ГАРАНТІЇ ТА ВІДМОВА ВІД ВІДПОВІДАЛЬНОСТІ</p>
                <p>Програмне забезпечення надається "як є" без будь-яких гарантій.</p>
                <br>
                <p>5. ВІДШКОДУВАННЯ ЗБИТКІВ</p>
                <p>Ліцензіат погоджується відшкодувати Ліцензіару будь-які збитки, що виникли внаслідок порушення цієї Угоди.</p>
                <br>
                <p>6. ПРИПИНЕННЯ</p>
                <p>Ця Угода діє до її припинення. Ліцензіар має право припинити дію цієї Угоди в разі порушення її умов Ліцензіатом.</p>
                <br>
                <p>7. ЗАГАЛЬНІ ПОЛОЖЕННЯ</p>
                <p>Ця Угода регулюється законодавством України. Всі спори, що виникають в зв'язку з цією Угодою, підлягають вирішенню в судах України.</p>
            </div>
            <button class="modal-back-button">${getTranslation('back', 'Назад')}</button>
        </div>
    `;
    document.body.appendChild(modal);

    // Додаємо обробники подій
    modal.querySelector('.close-modal').onclick = () => modal.remove();
    modal.querySelector('.modal-back-button').onclick = () => modal.remove();
    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
}

/**
 * Функція для показу модального вікна з угодою користувача
 */
function showAgreementModal() {
    // Видаляємо попередні модальні вікна, якщо вони є
    document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

    // Створюємо нове модальне вікно
    const modal = document.createElement('div');
    modal.className = 'document-modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Угода користувача WINIX</div>
                <span class="close-modal">×</span>
            </div>
            <div class="modal-scrollable-content">
                <p>Версія 1.0, Березень 2025</p>
                <br>
                <p>Ласкаво просимо до WINIX!</p>
                <br>
                <p>Ця Угода користувача ("Угода") регулює використання Вами мобільного додатку WINIX та всіх пов'язаних послуг.</p>
                <br>
                <p>1. ПРИЙНЯТТЯ УМОВ</p>
                <p>Використовуючи WINIX, Ви погоджуєтесь з умовами цієї Угоди. Якщо Ви не погоджуєтесь з умовами, Ви не маєте права використовувати WINIX.</p>
                <br>
                <p>2. РЕЄСТРАЦІЯ ТА БЕЗПЕКА</p>
                <p>Для використання WINIX Вам необхідно створити обліковий запис. Ви зобов'язані надати достовірну інформацію та забезпечити безпеку свого облікового запису.</p>
                <br>
                <p>3. КОНФІДЕНЦІЙНІСТЬ</p>
                <p>Ваша конфіденційність є важливою для нас. Збір та використання Ваших персональних даних регулюється нашою Політикою конфіденційності.</p>
                <br>
                <p>4. ВИКОРИСТАННЯ ТОКЕНІВ WINIX</p>
                <p>Токени WINIX є внутрішньою валютою додатку та не мають реальної вартості. Ви не маєте права продавати або обмінювати токени WINIX за межами додатку.</p>
                <br>
                <p>5. ПРАВИЛА ПОВЕДІНКИ</p>
                <p>Ви зобов'язуєтесь не використовувати WINIX для незаконних або шахрайських цілей.</p>
                <br>
                <p>6. ЗМІНИ В УГОДІ</p>
                <p>Ми залишаємо за собою право змінювати цю Угоду в будь-який час. Зміни вступають в силу після їх публікації в додатку.</p>
                <br>
                <p>7. ПРИПИНЕННЯ</p>
                <p>Ми залишаємо за собою право припинити або обмежити Ваш доступ до WINIX в разі порушення цієї Угоди.</p>
            </div>
            <button class="modal-back-button">${getTranslation('back', 'Назад')}</button>
        </div>
    `;
    document.body.appendChild(modal);

    // Додаємо обробники подій
    modal.querySelector('.close-modal').onclick = () => modal.remove();
    modal.querySelector('.modal-back-button').onclick = () => modal.remove();
    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
}

        /**
 * Функція для завантаження налаштувань користувача
 */
function loadUserSettings() {
    console.log("Завантаження налаштувань користувача...");

    // Отримуємо ID користувача
    const userId = localStorage.getItem('userId') || '12345678';

    // Запит до сервера для отримання налаштувань
    fetch(`/api/user/${userId}/settings`)
        .then(response => {
            if (!response.ok) throw new Error(`Помилка HTTP: ${response.status}`);
            return response.json();
        })
        .then(data => {
            if (data.status === 'success' && data.data) {
                const settings = data.data;
                console.log("Отримано налаштування користувача:", settings);

                // Оновлюємо ім'я користувача
                if (settings.username) {
                    document.getElementById('profile-name').textContent = settings.username;
                    localStorage.setItem('username', settings.username);
                }

                // Оновлюємо мову інтерфейсу
                const lang = settings.language || 'uk';
                document.querySelectorAll('.language-option').forEach(opt => {
                    opt.classList.toggle('active', opt.getAttribute('data-lang') === lang);
                });
                localStorage.setItem('userLanguage', lang);

                // Оновлюємо статус сповіщень
                const notificationsEnabled = settings.notifications_enabled !== false;
                document.getElementById('notifications-toggle').checked = notificationsEnabled;
                localStorage.setItem('notificationsEnabled', notificationsEnabled.toString());

                // Оновлюємо аватар, якщо є URL
                if (settings.avatar_url) {
                    localStorage.setItem('userAvatarSrc', settings.avatar_url);
                    loadUserAvatar();
                } else if (settings.avatar_id) {
                    localStorage.setItem('selectedAvatarId', settings.avatar_id);
                    // Перевіряємо, чи є в localStorage збережений URL для цього аватару
                    if (!localStorage.getItem(`${settings.avatar_id}Src`)) {
                        // Якщо немає, зберігаємо стандартний шлях
                        localStorage.setItem(`${settings.avatar_id}Src`, `assets/avatar${settings.avatar_id}.png`);
                    }
                    loadUserAvatar();
                }

                // Оновлюємо текстові елементи відповідно до обраної мови
                updatePageTexts();
            } else {
                console.warn("Отримано некоректні дані налаштувань:", data);
            }
        })
        .catch(error => {
            console.error("❌ Помилка отримання налаштувань:", error);
        });
}

/**
 * Функція для збереження налаштувань користувача
 * @param {Object} settings - Об'єкт з налаштуваннями для збереження
 */
function saveUserSettings(settings) {
    console.log("Збереження налаштувань користувача:", settings);

    // Отримуємо ID користувача
    const userId = localStorage.getItem('userId') || '12345678';

    // Показуємо індикатор завантаження
    const spinner = document.getElementById('loading-spinner');
    if (spinner) spinner.style.display = 'flex';

    // Запит до сервера для збереження налаштувань
    fetch(`/api/user/${userId}/settings`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(settings)
    })
    .then(response => {
        if (!response.ok) throw new Error(`Помилка HTTP: ${response.status}`);
        return response.json();
    })
    .then(data => {
        if (data.status === 'success') {
            console.log("Налаштування успішно збережено");
            showToast(getTranslation('settings_saved', 'Налаштування збережено'));

            // Оновлюємо локальні налаштування
            if (settings.language) {
                localStorage.setItem('userLanguage', settings.language);
                // Оновлюємо мову інтерфейсу
                if (window.WinixLanguage && typeof window.WinixLanguage.changeLang === 'function') {
                    window.WinixLanguage.changeLang(settings.language);
                }
                updatePageTexts();
            }

            if (settings.notifications_enabled !== undefined) {
                localStorage.setItem('notificationsEnabled', settings.notifications_enabled.toString());
            }

            if (settings.username) {
                localStorage.setItem('username', settings.username);
                document.getElementById('profile-name').textContent = settings.username;
            }

            // Оновлюємо аватар, якщо він був оновлений
            if (settings.avatar_url || settings.avatar_id) {
                loadUserAvatar();
            }
        } else {
            console.warn("Помилка збереження налаштувань:", data);
            showToast(data.message || getTranslation('settings_error', 'Помилка збереження налаштувань'), true);
        }
    })
    .catch(error => {
        console.error("❌ Помилка збереження налаштувань:", error);
        showToast("Помилка з'єднання з сервером", true);
    })
    .finally(() => {
        // Ховаємо індикатор завантаження
        if (spinner) spinner.style.display = 'none';
    });
}

/**
 * Функція для оновлення паролю користувача
 * @param {string} password - Новий пароль
 * @param {string} currentPassword - Поточний пароль (якщо є)
 */
function updateUserPassword(password, currentPassword = null) {
    console.log("Оновлення паролю користувача");

    // Якщо пароль порожній, виходимо
    if (!password) {
        showToast(getTranslation('password_required', 'Потрібно ввести пароль'), true);
        return;
    }

    // Перевіряємо валідність пароля
    const validation = validatePassword(password);
    if (!validation.valid) {
        showToast(validation.message, true);
        return;
    }

    // Отримуємо ID користувача
    const userId = localStorage.getItem('userId') || '12345678';

    // Показуємо індикатор завантаження
    const spinner = document.getElementById('loading-spinner');
    if (spinner) spinner.style.display = 'flex';

    // Створюємо хеш пароля (проста імітація)
    const passwordHash = hashPassword(password);

    // Підготовка даних для запиту
    const requestData = {
        password_hash: passwordHash
    };

    // Якщо є поточний пароль, додаємо його для перевірки
    if (currentPassword) {
        requestData.current_password_hash = hashPassword(currentPassword);
    }

    // Запит до сервера для оновлення пароля
    fetch(`/api/user/${userId}/password`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        if (!response.ok) throw new Error(`Помилка HTTP: ${response.status}`);
        return response.json();
    })
    .then(data => {
        if (data.status === 'success') {
            console.log("Пароль успішно оновлено");
            showToast("Пароль успішно оновлено");

            // Зберігаємо хеш пароля в localStorage
            localStorage.setItem('passwordHash', passwordHash);
            localStorage.setItem('seedPhrasePasswordHash', passwordHash);
        } else {
            console.warn("Помилка оновлення пароля:", data);
            showToast(data.message || "Помилка оновлення пароля", true);
        }
    })
    .catch(error => {
        console.error("❌ Помилка оновлення пароля:", error);
        showToast("Помилка з'єднання з сервером", true);
    })
    .finally(() => {
        // Ховаємо індикатор завантаження
        if (spinner) spinner.style.display = 'none';
    });
}

/**
 * Функція для валідації пароля
 * @param {string} password - Пароль для перевірки
 * @returns {Object} - Результат перевірки {valid: boolean, message: string}
 */
function validatePassword(password) {
    if (!password || password.length < 8)
        return { valid: false, message: getTranslation('min_8_chars', 'Пароль має містити не менше 8 символів') };

    if ((password.match(/[a-zA-Zа-яА-ЯіїєґІЇЄҐ]/g) || []).length < 5)
        return { valid: false, message: getTranslation('min_5_letters', 'Пароль має містити не менше 5 літер') };

    return { valid: true };
}

/**
 * Функція для хешування пароля (проста імітація)
 * @param {string} password - Пароль для хешування
 * @returns {string} - Хеш пароля
 */
function hashPassword(password) {
    let hash = 0;
    if (password.length === 0) return hash.toString();
    for (let i = 0; i < password.length; i++) {
        const char = password.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return hash.toString() + "winix";
}

/**
 * Функція для оновлення аватара користувача
 */
function loadUserAvatar() {
    const headerAvatar = document.getElementById('profile-avatar');
    const profileAvatar = document.getElementById('profile-avatar-large');

    const username = localStorage.getItem('username') || 'WINIX User';
    const avatarSrc = localStorage.getItem('userAvatarSrc');
    const avatarId = localStorage.getItem('selectedAvatarId');

    function setAvatar(element) {
        if (!element) return;
        element.innerHTML = '';

        if (avatarSrc) {
            const img = new Image();
            img.src = avatarSrc;
            img.alt = username;
            img.onerror = () => {
                console.log('Помилка завантаження аватара, використовуємо текст');
                element.textContent = username[0].toUpperCase();
            };
            element.appendChild(img);
        } else if (avatarId) {
            const src = localStorage.getItem(`${avatarId}Src`) || `assets/avatar${avatarId}.png`;
            const img = new Image();
            img.src = src;
            img.alt = username;
            img.onerror = () => {
                console.log('Помилка завантаження аватара, використовуємо запасний варіант');
                element.textContent = username[0].toUpperCase();
            };
            element.appendChild(img);
        } else {
            element.textContent = username[0].toUpperCase();
        }
    }

    setAvatar(headerAvatar);
    setAvatar(profileAvatar);
}

/**
 * Функція для отримання перекладу
 * @param {string} key - Ключ перекладу
 * @param {string} defaultText - Текст за замовчуванням
 * @returns {string} - Перекладений текст
 */
function getTranslation(key, defaultText = key) {
    if (window.WinixLanguage && typeof window.WinixLanguage.getText === 'function') {
        try {
            return window.WinixLanguage.getText(key) || defaultText;
        } catch (error) {
            console.error(`Помилка отримання перекладу для ключа ${key}:`, error);
            return defaultText;
        }
    }

    // Якщо немає глобального об'єкту з перекладами, використовуємо локальні переклади
    const translations = {
        "settings": "Налаштування",
        "edit_profile": "Редагувати профіль",
        "language_selection": "Вибір мови",
        "language_uk": "Українська",
        "language_en": "English",
        "language_ru": "Русский",
        "app_settings": "Налаштування додатку",
        "notifications": "Сповіщення",
        "security": "Безпека",
        "show_seed": "Показати SID фразу",
        "back": "Назад",
        "coins": "Жетони",
        "user_id": "ID:",
        "settings_saved": "Налаштування збережено",
        "settings_error": "Помилка збереження"
    };

    return translations[key] || defaultText;
}

/**
 * Функція для оновлення текстів на сторінці відповідно до обраної мови
 */
function updatePageTexts() {
    document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        if (key) {
            element.textContent = getTranslation(key, key);
        }
    });
}

        function updatePageTexts() {
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (key) {
                    element.textContent = getTranslation(key, key);
                }
            });
        }
        function showSeedPhrase() {
            console.log("Виклик функції showSeedPhrase");
            const userId = localStorage.getItem('userId') || '12345678';
            const phrase = generateSeedPhrase(userId);

            document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

            const modal = document.createElement('div');
            modal.className = 'document-modal show';
            modal.innerHTML = `
                <div class="seed-modal-content">
                    <div class="modal-header">
                        <div class="modal-title">${getTranslation('seed_phrase', 'SID фраза')}</div>
                        <span class="close-modal">×</span>
                    </div>
                    <div class="modal-body">
                        <div class="restore-card">
                            <div class="restore-title">${getTranslation('your_seed_phrase', 'Ваша SID фраза')}</div>
                            <div class="restore-subtitle">${getTranslation('save_seed', 'Збережіть цю фразу в надійному місці')}</div>
                            <button class="copy-button">${getTranslation('copy', 'Копіювати')}</button>
                            <div class="words-grid">
                                ${phrase.map((word, i) => `
                                    <div class="word-cell">
                                        <div class="word-number">${i + 1}.</div>
                                        <div class="word-value">${word}</div>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="seed-continue-button">${getTranslation('done', 'Готово')}</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.close-modal').onclick = () => modal.remove();
            modal.querySelector('.copy-button').onclick = () => {
                navigator.clipboard.writeText(phrase.join(' '))
                    .then(() => showToast(getTranslation('copied', 'Скопійовано')))
                    .catch(() => showToast(getTranslation('copy_error', 'Помилка копіювання'), true));
            };
            modal.querySelector('.seed-continue-button').onclick = () => {
                localStorage.setItem('seedPhraseViewed', 'true');
                modal.remove();
            };
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        function showSetPasswordModal(callback) {
            document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

            const modal = document.createElement('div');
            modal.className = 'document-modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">${getTranslation('set_password', 'Встановлення паролю')}</div>
                        <span class="close-modal">×</span>
                    </div>
                    <div class="modal-body">
                        <p>${getTranslation('password_requirements', 'Пароль має містити не менше 8 символів, включаючи 5 літер')}</p>
                        <input type="password" id="new-password" placeholder="${getTranslation('password', 'Пароль')}">
                        <input type="password" id="confirm-password" placeholder="${getTranslation('confirm', 'Підтвердження')}">
                        <div id="error-msg"></div>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-button" id="save-password">${getTranslation('btn_save', 'Зберегти')}</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const saveBtn = modal.querySelector('#save-password');
            saveBtn.onclick = () => {
                const pwd = modal.querySelector('#new-password').value;
                const confirm = modal.querySelector('#confirm-password').value;
                const error = modal.querySelector('#error-msg');

                if (pwd !== confirm) {
                    error.textContent = getTranslation('passwords_dont_match', 'Паролі не співпадають');
                    return;
                }
                const validation = validatePassword(pwd);
                if (!validation.valid) {
                    error.textContent = validation.message;
                    return;
                }

                const passwordHash = hashPassword(pwd);
                localStorage.setItem('passwordHash', passwordHash);
                localStorage.setItem('seedPhrasePasswordHash', passwordHash);

                modal.remove();
                if (typeof callback === 'function') {
                    callback(pwd);
                }
            };
            modal.querySelector('.close-modal').onclick = () => modal.remove();
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        function showEnterPasswordModal(callback) {
            document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

            const modal = document.createElement('div');
            modal.className = 'document-modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">${getTranslation('enter_password', 'Введіть пароль')}</div>
                        <span class="close-modal">×</span>
                    </div>
                    <div class="modal-body">
                        <input type="password" id="enter-password" placeholder="${getTranslation('your_password', 'Ваш пароль')}">
                        <div id="error-msg"></div>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-button" id="check-password">${getTranslation('check', 'Перевірити')}</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const checkBtn = modal.querySelector('#check-password');
            checkBtn.onclick = () => {
                const pwd = modal.querySelector('#enter-password').value;
                const error = modal.querySelector('#error-msg');

                const savedPassHash = localStorage.getItem('passwordHash');
                const savedSeedHash = localStorage.getItem('seedPhrasePasswordHash');
                const inputHash = hashPassword(pwd);

                if (inputHash === savedPassHash || inputHash === savedSeedHash) {
                    modal.remove();
                    if (typeof callback === 'function') {
                        callback(pwd);
                    }
                } else {
                    error.textContent = getTranslation('wrong_password', 'Невірний пароль');
                }
            };
            modal.querySelector('.close-modal').onclick = () => modal.remove();
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        function handleShowSeedPhrase() {
            console.log("Виклик функції handleShowSeedPhrase");
            try {
                const savedPassHash = localStorage.getItem('passwordHash');
                const savedSeedHash = localStorage.getItem('seedPhrasePasswordHash');
                const hasPassword = savedPassHash || savedSeedHash;

                console.log("Наявність паролю:", !!hasPassword);

                if (!hasPassword) {
                    console.log("Пароль відсутній, показуємо модалку встановлення паролю");
                    showSetPasswordModal(function(password) {
                        console.log("Пароль встановлено, показуємо SID фразу");
                        showSeedPhrase();
                    });
                } else {
                    console.log("Пароль наявний, показуємо модалку введення паролю");
                    showEnterPasswordModal(function(password) {
                        console.log("Пароль підтверджено, показуємо SID фразу");
                        showSeedPhrase();
                    });
                }
            } catch (error) {
                console.error("Помилка при обробці показу SID фрази:", error);
                showToast("Виникла помилка при спробі показати SID фразу", true);
            }
        }

        function showLicenseModal() {
            document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

            const modal = document.createElement('div');
            modal.className = 'document-modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">Ліцензійна угода WINIX</div>
                        <span class="close-modal">×</span>
                    </div>
                    <div class="modal-scrollable-content">
                        <p>Версія 1.0, Березень 2025</p>
                        <br>
                        <p>Ця ліцензійна угода ("Угода") укладена між WINIX ("Ліцензіар") та Вами ("Ліцензіат").</p>
                        <br>
                        <p>1. НАДАННЯ ЛІЦЕНЗІЇ</p>
                        <p>Ліцензіар надає Ліцензіату невиключну ліцензію на використання програмного забезпечення WINIX ("Програмне забезпечення") відповідно до умов цієї Угоди.</p>
                        <br>
                        <p>2. ОБМЕЖЕННЯ</p>
                        <p>Ліцензіат не має права:</p>
                        <p>- Копіювати або розповсюджувати Програмне забезпечення</p>
                        <p>- Модифікувати, декомпілювати або дизасемблювати Програмне забезпечення</p>
                        <p>- Використовувати Програмне забезпечення для незаконних цілей</p>
                        <br>
                        <p>3. ПРАВА ВЛАСНОСТІ</p>
                        <p>Програмне забезпечення є власністю Ліцензіара та захищено законами про інтелектуальну власність.</p>
                        <br>
                        <p>4. ГАРАНТІЇ ТА ВІДМОВА ВІД ВІДПОВІДАЛЬНОСТІ</p>
                        <p>Програмне забезпечення надається "як є" без будь-яких гарантій.</p>
                        <br>
                        <p>5. ВІДШКОДУВАННЯ ЗБИТКІВ</p>
                        <p>Ліцензіат погоджується відшкодувати Ліцензіару будь-які збитки, що виникли внаслідок порушення цієї Угоди.</p>
                        <br>
                        <p>6. ПРИПИНЕННЯ</p>
                        <p>Ця Угода діє до її припинення. Ліцензіар має право припинити дію цієї Угоди в разі порушення її умов Ліцензіатом.</p>
                        <br>
                        <p>7. ЗАГАЛЬНІ ПОЛОЖЕННЯ</p>
                        <p>Ця Угода регулюється законодавством України. Всі спори, що виникають в зв'язку з цією Угодою, підлягають вирішенню в судах України.</p>
                    </div>
                    <button class="modal-back-button">${getTranslation('back', 'Назад')}</button>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.close-modal').onclick = () => modal.remove();
            modal.querySelector('.modal-back-button').onclick = () => modal.remove();
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        function showAgreementModal() {
            document.querySelectorAll('.document-modal').forEach(modal => modal.remove());

            const modal = document.createElement('div');
            modal.className = 'document-modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">Угода користувача WINIX</div>
                        <span class="close-modal">×</span>
                    </div>
                    <div class="modal-scrollable-content">
                        <p>Версія 1.0, Березень 2025</p>
                        <br>
                        <p>Ласкаво просимо до WINIX!</p>
                        <br>
                        <p>Ця Угода користувача ("Угода") регулює використання Вами мобільного додатку WINIX та всіх пов'язаних послуг.</p>
                        <br>
                        <p>1. ПРИЙНЯТТЯ УМОВ</p>
                        <p>Використовуючи WINIX, Ви погоджуєтесь з умовами цієї Угоди. Якщо Ви не погоджуєтесь з умовами, Ви не маєте права використовувати WINIX.</p>
                        <br>
                        <p>2. РЕЄСТРАЦІЯ ТА БЕЗПЕКА</p>
                        <p>Для використання WINIX Вам необхідно створити обліковий запис. Ви зобов'язані надати достовірну інформацію та забезпечити безпеку свого облікового запису.</p>
                        <br>
                        <p>3. КОНФІДЕНЦІЙНІСТЬ</p>
                        <p>Ваша конфіденційність є важливою для нас. Збір та використання Ваших персональних даних регулюється нашою Політикою конфіденційності.</p>
                        <br>
                        <p>4. ВИКОРИСТАННЯ ТОКЕНІВ WINIX</p>
                        <p>Токени WINIX є внутрішньою валютою додатку та не мають реальної вартості. Ви не маєте права продавати або обмінювати токени WINIX за межами додатку.</p>
                        <br>
                        <p>5. ПРАВИЛА ПОВЕДІНКИ</p>
                        <p>Ви зобов'язуєтесь не використовувати WINIX для незаконних або шахрайських цілей.</p>
                        <br>
                        <p>6. ЗМІНИ В УГОДІ</p>
                        <p>Ми залишаємо за собою право змінювати цю Угоду в будь-який час. Зміни вступають в силу після їх публікації в додатку.</p>
                        <br>
                        <p>7. ПРИПИНЕННЯ</p>
                        <p>Ми залишаємо за собою право припинити або обмежити Ваш доступ до WINIX в разі порушення цієї Угоди.</p>
                    </div>
                    <button class="modal-back-button">${getTranslation('back', 'Назад')}</button>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.close-modal').onclick = () => modal.remove();
            modal.querySelector('.modal-back-button').onclick = () => modal.remove();
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        /**
 * Налаштування обробників подій на сторінці
 */
function setupEventHandlers() {
    console.log("Налаштування обробників подій");

    // Кнопка редагування профілю
    const editProfileBtn = document.getElementById('edit-profile');
    if (editProfileBtn) {
        editProfileBtn.addEventListener('click', function() {
            showEditProfileModal();
        });
    }

    // Обробка вибору мови
    const languageOptions = document.querySelectorAll('.language-option');
    languageOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Знімаємо активний стан з усіх мов
            languageOptions.forEach(opt => opt.classList.remove('active'));

            // Встановлюємо активний стан для обраної мови
            this.classList.add('active');

            // Отримуємо код обраної мови
            const selectedLang = this.getAttribute('data-lang');

            // Зберігаємо налаштування мови на сервері та в localStorage
            saveUserSettings({ language: selectedLang });

            // Оновлюємо тексти на сторінці, якщо є глобальний об'єкт з перекладами
            if (window.WinixLanguage && typeof window.WinixLanguage.changeLang === 'function') {
                window.WinixLanguage.changeLang(selectedLang);
            } else {
                // Інакше просто оновлюємо тексти через нашу функцію
                updatePageTexts();
            }
        });
    });

    // Перемикач сповіщень
    const notificationsToggle = document.getElementById('notifications-toggle');
    if (notificationsToggle) {
        notificationsToggle.addEventListener('change', function() {
            saveUserSettings({ notifications_enabled: this.checked });
        });
    }

    // Кнопка показу SID фрази
    const showSeedBtn = document.getElementById('show-seed-phrase');
    if (showSeedBtn) {
        showSeedBtn.addEventListener('click', function() {
            handleShowSeedPhrase();
        });
    }

    // Навігаційні елементи
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
            const section = this.getAttribute('data-section');

            // Якщо вже на цій сторінці, нічого не робимо
            if (section === 'general') {
                console.log('Вже на сторінці налаштувань');
                return;
            }

            // Переходимо на відповідну сторінку
            switch (section) {
                case 'home':
                    navigateTo('index.html');
                    break;
                case 'earn':
                    navigateTo('earn.html');
                    break;
                case 'referrals':
                    navigateTo('referrals.html');
                    break;
                case 'wallet':
                    navigateTo('wallet.html');
                    break;
                default:
                    navigateTo(`${section}.html`);
            }
        });
    });

    // Кнопки внизу сторінки
    const helpButton = document.getElementById('help-button');
    const licenseButton = document.getElementById('license-button');
    const agreementButton = document.getElementById('agreement-button');

    if (helpButton) {
        helpButton.addEventListener('click', function(e) {
            if (!this.getAttribute('href')) {
                e.preventDefault();
                window.open('https://t.me/Winix_Support', '_blank');
            }
        });
    }

    if (licenseButton) {
        licenseButton.addEventListener('click', function() {
            showLicenseModal();
        });
    }

    if (agreementButton) {
        agreementButton.addEventListener('click', function() {
            showAgreementModal();
        });
    }

    // Обробник кліку на аватар у хедері
    const profileAvatar = document.getElementById('profile-avatar');
    if (profileAvatar) {
        profileAvatar.addEventListener('click', function() {
            showEditProfileModal();
        });
    }

    console.log("Обробники подій успішно налаштовано");
}

/**
 * Додавання спіннера завантаження, якщо його немає
 */
function addLoadingSpinner() {
    if (!document.getElementById('loading-spinner')) {
        const spinner = document.createElement('div');
        spinner.id = 'loading-spinner';
        spinner.className = 'spinner';
        spinner.innerHTML = '<div class="spinner-inner"></div>';
        document.body.appendChild(spinner);

        const spinnerStyle = document.createElement('style');
        spinnerStyle.textContent = `
            .spinner {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 9999;
                justify-content: center;
                align-items: center;
                backdrop-filter: blur(2px);
            }
            .spinner-inner {
                width: 50px;
                height: 50px;
                border: 4px solid rgba(0, 201, 167, 0.3);
                border-radius: 50%;
                border-top: 4px solid rgba(0, 201, 167, 1);
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(spinnerStyle);
    }
}

/**
 * Основна функція ініціалізації сторінки
 */
document.addEventListener('DOMContentLoaded', function() {
    console.log("DOMContentLoaded: Ініціалізація сторінки налаштувань");

    // Додаємо спіннер завантаження
    addLoadingSpinner();

    // Завантажуємо дані користувача з сервера
    loadUserData();

    // Запускаємо періодичне оновлення
    startPeriodicUpdates();

    // Налаштовуємо обробники подій
    setupEventHandlers();

    console.log("✅ Сторінку налаштувань успішно ініціалізовано");
});

// Ініціалізація при відновленні сторінки з кешу
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        console.log("Сторінка відновлена з кешу, оновлюємо дані");
        loadUserData();
    }
});

// Обробка глобальних помилок
window.onerror = function(message, source, lineno, colno, error) {
    console.error(`Глобальна помилка JavaScript: ${message} у ${source}:${lineno}:${colno}`);
    showToast("Виникла помилка під час виконання скрипту", true);
    return true; // Запобігаємо виведенню помилки в консоль браузера
};

        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            // Завантажуємо дані з сервера
            loadUserData();

            // Запускаємо періодичне оновлення
            startPeriodicUpdates();

            loadUserSettings();
            loadUserAvatar();
            updateBalanceDisplay();
            setupEventHandlers();
        }

        console.log("✅ Сторінку налаштувань успішно ініціалізовано");
        document.dispatchEvent(new CustomEvent('settings-initialized'));

        const errorStyles = document.createElement('style');
        errorStyles.textContent = `
            #error-msg {
                color: #f44336;
                background-color: rgba(244, 67, 54, 0.1);
                border-left: 3px solid #f44336;
                padding: 8px 12px;
                margin: 10px 0;
                border-radius: 4px;
                font-size: 14px;
                transition: all 0.3s ease;
            }
            .wrong-password-message {
                color: #f44336;
                font-weight: bold;
                padding: 10px;
                background-color: rgba(244, 67, 54, 0.1);
                border-radius: 5px;
                margin-top: 10px;
            }
        `;
        document.head.appendChild(errorStyles);

        function checkMobileVersion() {
            const isMobile = window.innerWidth < 768;
            document.body.classList.toggle('mobile-version', isMobile);
        }

        window.addEventListener('resize', checkMobileVersion);
        checkMobileVersion();

        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        }
        /**
 * Функція для завантаження даних користувача з сервера
 */
function loadUserData() {
    console.log("Завантаження даних користувача з сервера...");

    // Показуємо індикатор завантаження (якщо є)
    const spinner = document.getElementById('loading-spinner');
    if (spinner) spinner.style.display = 'flex';

    // Отримуємо ID користувача
    const userId = localStorage.getItem('userId') || '12345678';

    // Робимо запит до API
    fetch(`/api/user/${userId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Помилка HTTP: ${response.status}`);
            }
            return response.json();
        })
        .then(result => {
            if (result.status === 'success' && result.data) {
                const userData = result.data;
                console.log("Отримано дані користувача:", userData);

                // Оновлюємо ID користувача в всіх елементах
                document.getElementById('user-id').textContent = userData.id;
                document.getElementById('user-id-profile').textContent = userData.id;

                // Оновлюємо ім'я користувача
                const username = userData.username || 'WINIX User';
                document.getElementById('profile-name').textContent = username;
                localStorage.setItem('username', username);

                // Оновлюємо баланс токенів
                const tokens = userData.balance || 0;
                document.getElementById('user-tokens').textContent = tokens.toFixed(2);
                localStorage.setItem('userTokens', tokens.toString());

                // Оновлюємо баланс жетонів
                const coins = userData.coins || 0;
                document.getElementById('user-coins').textContent = coins.toString();
                localStorage.setItem('userCoins', coins.toString());

                // Оновлюємо аватар
                loadUserAvatar();

                // Завантажуємо налаштування користувача
                loadUserSettings();

                // Зберігаємо ID для подальших запитів
                localStorage.setItem('userId', userData.id);

                console.log("✅ Дані користувача успішно оновлено з сервера");
            } else {
                console.warn("Отримано некоректні дані:", result);
                showToast("Помилка отримання даних з сервера", true);
            }
        })
        .catch(error => {
            console.error('❌ Помилка отримання даних з сервера:', error);
            showToast("Помилка підключення до сервера. Спробуйте пізніше.", true);
        })
        .finally(() => {
            // Ховаємо індикатор завантаження
            if (spinner) spinner.style.display = 'none';
        });
}

/**
 * Функція періодичного оновлення даних
 */
function startPeriodicUpdates() {
    console.log("Запуск періодичного оновлення даних");

    // Оновлюємо дані кожні 30 секунд
    setInterval(loadUserData, 30000);
}
    </script>
</body>
</html>