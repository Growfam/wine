<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="WINIX - Виконуйте завдання та заробляйте токени">
    <meta name="theme-color" content="#1A1A2E">
    <title>WINIX - Заробляй</title>

    <!-- Критичні стилі для швидкого відображення -->
    <style>
        /* Базові стилі для найшвидшого рендерингу контенту */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #0F0F1A;
            color: #FFFFFF;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            position: relative;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: #1A1A2E;
        }
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
        }
        .loading-indicator .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #E94560;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ВИПРАВЛЕНО: Критичні стилі для вкладок і контентних секцій */
        .content-section {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
            position: relative;
        }
        .content-section.active {
            display: block;
            opacity: 1;
            z-index: 2;
        }
        .tab {
            position: relative;
            cursor: pointer;
        }
        .tab.active {
            background: linear-gradient(135deg, #4eb5f7, #00C9A7);
            color: white;
            font-weight: bold;
        }

        /* ВИПРАВЛЕНО: Правила для гарантування видимості кнопки бонусу */
        #claim-daily, .claim-button {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            pointer-events: auto !important;
        }

        #daily-bonus-container .claim-button:disabled {
            opacity: 0.7 !important;
            cursor: not-allowed !important;
        }
    </style>

    <!-- Підключення основних стилів -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/earn/styles.css">

    <!-- Попереднє завантаження критичних ресурсів -->
    <link rel="preload" href="css/earn/components-tasks.css" as="style">
    <link rel="preload" href="js/core.js" as="script">
    <link rel="preload" href="js/tasks/core/task-manager.js" as="script">

    <!-- Відкладене завантаження некритичних стилів -->
    <link rel="stylesheet" href="css/earn/components-tasks.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/earn/leaderboard.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/earn/premium-animations.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/earn/winix-icons.css" media="print" onload="this.media='all'">

    <!-- Запасні варіанти для браузерів без підтримки onload для стилів -->
    <noscript>
        <link rel="stylesheet" href="css/earn/components-tasks.css">
        <link rel="stylesheet" href="css/earn/leaderboard.css">
        <link rel="stylesheet" href="css/earn/premium-animations.css">
        <link rel="stylesheet" href="css/earn/winix-icons.css">
    </noscript>

    <!-- Підключення Telegram WebApp API негайно -->
    <script src="js/telegram-web-app.js"></script>
</head>
<body>
<!-- Індикатор завантаження -->
<div id="initial-loading" class="loading-indicator">
    <div class="spinner"></div>
    <p>Завантаження...</p>
</div>

<svg class="winix-filters">
  <defs>
    <!-- Синє світіння -->
    <filter id="blue-glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
      <feFlood flood-color="#4EB5F7" flood-opacity="0.5" result="color" />
      <feComposite in="color" in2="blur" operator="in" result="glow" />
      <feMerge>
        <feMergeNode in="glow" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>

    <!-- Бірюзове світіння -->
    <filter id="teal-glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
      <feFlood flood-color="#00C9A7" flood-opacity="0.5" result="color" />
      <feComposite in="color" in2="blur" operator="in" result="glow" />
      <feMerge>
        <feMergeNode in="glow" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>

    <!-- Червоне світіння -->
    <filter id="red-glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
      <feFlood flood-color="#F44336" flood-opacity="0.5" result="color" />
      <feComposite in="color" in2="blur" operator="in" result="glow" />
      <feMerge>
        <feMergeNode in="glow" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>

    <!-- Золоте світіння -->
    <filter id="gold-glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
      <feFlood flood-color="#FFD700" flood-opacity="0.5" result="color" />
      <feComposite in="color" in2="blur" operator="in" result="glow" />
      <feMerge>
        <feMergeNode in="glow" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
  </defs>
</svg>
    <div class="container">
        <!-- Шапка сторінки -->
        <div class="header">
            <div class="user-profile" id="profile-link">
                <div class="profile-avatar" id="profile-avatar">W</div>
                <div class="user-id-container">
                    <span class="user-id-label" data-lang-key="user_id">ID:</span>
                    <span class="user-id-value" id="user-id"></span>
                </div>
            </div>
            <div class="winix-title">WINIX</div>
            <div class="balance-container">
                <div class="jeton-balance">
                    <div id="user-coins" class="balance-value">0</div>
                    <div class="balance-label" data-lang-key="coins">Жетони</div>
                </div>
                <div class="winix-balance">
                    <div id="user-tokens" class="balance-value">0</div>
                    <div class="balance-label">$WINIX</div>
                </div>
            </div>
        </div>

        <!-- Перемикач категорій завдань -->
        <div class="tabs">
            <div class="tab active" data-tab="social" data-lang-key="earn.social_networks">Соціальні</div>
            <div class="tab" data-tab="limited" data-lang-key="earn.limited_tasks">Лімітовані</div>
            <div class="tab" data-tab="partners" data-lang-key="earn.partners_tasks">Партнерські</div>
        </div>

        <!-- Контейнери для різних типів завдань -->
        <!-- Соціальні завдання -->
        <div class="content-section active" id="social-content">
            <!-- Щоденний бонус -->
            <div class="category-card" id="daily-bonus-container">
                <div class="category-title" data-lang-key="earn.daily_bonus">Щоденний бонус</div>
                <div class="daily-bonus">
                    <div class="daily-bonus-bar">
                        <div class="daily-progress" id="daily-progress-container">
                            <!-- Дні генеруються динамічно через JS -->
                        </div>
                    </div>
                    <button class="claim-button" id="claim-daily" data-lang-key="earn.get">Отримати бонус</button>
                </div>
            </div>

            <!-- Соціальні завдання -->
            <div class="category-card">
                <div class="category-title" data-lang-key="earn.social_networks">Соціальні мережі</div>
                <div class="task-container" id="social-tasks-container" aria-live="polite">
                    <!-- Соціальні завдання генеруються динамічно через JS -->
                    <div class="task-loader">Завантаження завдань...</div>
                </div>
            </div>

            <!-- Реферальні завдання -->
            <div class="category-card">
                <div class="category-title" data-lang-key="earn.referral_tasks">Реферальні завдання</div>
                <div class="task-container" id="referral-tasks-container" aria-live="polite">
                    <!-- Реферальні завдання генеруються динамічно через JS -->
                    <div class="task-loader">Завантаження завдань...</div>
                </div>
            </div>

            <!-- Лідерська дошка -->
            <div class="category-card">
                <div class="category-title" data-lang-key="earn.leaderboard">Лідерська дошка</div>
                <div class="leaderboard-title" data-lang-key="earn.leaderboard.title">Топ-10 користувачів з найбільшою кількістю запрошених друзів</div>
                <div class="leaderboard" id="leaderboard-container" aria-live="polite">
                    <!-- Лідерська дошка генерується динамічно через JS -->
                    <div class="leaderboard-loader">Завантаження лідерської дошки...</div>
                </div>
            </div>
        </div>

        <!-- Лімітовані завдання -->
        <div class="content-section" id="limited-content">
            <div class="category-card">
                <div class="category-title" data-lang-key="earn.limited_tasks">Обмежені за часом завдання</div>
                <div class="task-container" id="limited-tasks-container" aria-live="polite">
                    <!-- Лімітовані завдання генеруються динамічно через JS -->
                    <div class="task-loader">Завантаження завдань...</div>
                </div>
            </div>
        </div>

        <!-- Партнерські завдання -->
        <div class="content-section" id="partners-content">
            <div class="category-card">
                <div class="category-title" data-lang-key="earn.partners_tasks">Партнерські завдання</div>
                <div class="task-container" id="partners-tasks-container" aria-live="polite">
                    <!-- Партнерські завдання генеруються динамічно через JS -->
                    <div class="task-loader">Завантаження завдань...</div>
                </div>
            </div>
        </div>

        <!-- Нижня навігаційна панель -->
        <div class="nav-bar">
            <div class="nav-item" data-section="home">
                <div class="icon-wrapper">
                    <img src="assets/home-icon.png" alt="Home" loading="lazy" onerror="this.src='https://via.placeholder.com/35?text=Home'">
                </div>
                <span data-lang-key="home">Home</span>
            </div>
            <div class="nav-item active" data-section="earn">
                <div class="icon-wrapper">
                    <img src="assets/earn-icon.png" alt="Earn" loading="lazy" onerror="this.src='https://via.placeholder.com/35?text=Earn'">
                </div>
                <span data-lang-key="earn">Earn</span>
            </div>
            <div class="nav-item" data-section="referrals">
                <div class="icon-wrapper">
                    <img src="assets/referrals-icon.png" alt="Referrals" loading="lazy" onerror="this.src='https://via.placeholder.com/35?text=Referrals'">
                </div>
                <span data-lang-key="referrals">Referrals</span>
            </div>
            <div class="nav-item" data-section="wallet">
                <div class="icon-wrapper">
                    <img src="assets/wallet-icon.png" alt="Wallet" loading="lazy" onerror="this.src='https://via.placeholder.com/35?text=Wallet'">
                </div>
                <span data-lang-key="wallet">Wallet</span>
            </div>
            <div class="nav-item" data-section="general">
                <div class="icon-wrapper">
                    <img src="assets/general-icon.png" alt="General" loading="lazy" onerror="this.src='https://via.placeholder.com/35?text=General'">
                </div>
                <span data-lang-key="general">General</span>
            </div>
        </div>
    </div>

    <!-- Повідомлення для копіювання -->
    <div class="toast-message" id="toast-message" aria-live="assertive" role="alert">Реферальне посилання скопійовано в буфер обміну!</div>

    <!-- ВИПРАВЛЕНО: Порядок завантаження скриптів для забезпечення правильної ініціалізації -->

    <!-- Спочатку завантажуємо утиліти та API -->
    <script src="js/tasks/utils/api-connectivity.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>

    <!-- Потім базові утиліти -->
    <script src="js/tasks/utils/formatters.js"></script>
    <script src="js/tasks/utils/storage.js"></script>
    <script src="js/tasks/utils/time-utils.js"></script>
    <script src="js/tasks/utils/validators.js"></script>

    <!-- Далі UI компоненти -->
    <script src="js/tasks/ui/animations.js"></script>
    <script src="js/tasks/ui/countdown.js"></script>
    <script src="js/tasks/ui/notifications.js"></script>
    <script src="js/tasks/ui/progress-bar.js"></script>

    <!-- Тепер основні компоненти -->
    <script src="js/tasks/components/daily-bonus.js"></script>
    <script src="js/tasks/components/social-task.js"></script>
    <script src="js/tasks/components/limited-task.js"></script>
    <script src="js/tasks/components/partner-task.js"></script>
    <script src="js/tasks/components/leaderboard.js"></script>

    <!-- Основна логіка модулів -->
    <script src="js/tasks/core/task-manager.js"></script>
    <script src="js/tasks/core/progress.js"></script>
    <script src="js/tasks/core/rewards.js"></script>
    <script src="js/tasks/core/verification.js"></script>
    <script src="js/tasks/core/integration.js"></script>

    <!-- Нарешті основний скрипт -->
    <script src="js/core.js"></script>

    <script>
        // ВИПРАВЛЕНО: Покращена система ініціалізації з чітким порядком виконання
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');

            // Діагностична перевірка системи
            window.diagnoseSystemState = function() {
                console.group('Діагностика системи');
                console.log('DOM готовий:', document.readyState);
                console.log('API доступний:', !!window.API);
                console.log('API_PATHS доступний:', !!window.API_PATHS);
                console.log('TaskManager доступний:', !!window.TaskManager);
                console.log('SocialTask доступний:', !!window.SocialTask);
                console.log('DailyBonus доступний:', !!window.DailyBonus);
                console.log('TaskIntegration доступний:', !!window.TaskIntegration);
                console.log('Core доступний:', !!window.WinixCore);
                console.groupEnd();
            };

            // Відстеження помилок завантаження
            window.trackLoadErrors = function() {
                const loadedScripts = {};
                const scripts = document.querySelectorAll('script');
                scripts.forEach(script => {
                    if (script.src) {
                        const name = script.src.split('/').pop();
                        loadedScripts[name] = script.complete;
                    }
                });
                return loadedScripts;
            };

            // Прихований індикатор завантаження через 3 секунди, якщо сторінка завантажилась швидше
            setTimeout(function() {
                const loadingIndicator = document.getElementById('initial-loading');
                if (loadingIndicator) {
                    loadingIndicator.style.opacity = '0';
                    setTimeout(() => {
                        loadingIndicator.style.display = 'none';
                    }, 300);
                }
            }, 3000);

            // Ініціалізуємо Telegram WebApp, якщо він доступний
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
            }

            // ВИПРАВЛЕНО: Покращення ініціалізації компонентів з відстеженням залежностей
            // Перевіряємо необхідні компоненти і завантажуємо їх поступово
            const initializationPlan = [
                {
                    name: 'Core',
                    check: () => window.Core,
                    init: () => window.Core.init(),
                    required: true,
                    initialized: false
                },
                {
                    name: 'TaskIntegration',
                    check: () => window.TaskIntegration,
                    init: () => window.TaskIntegration.init(),
                    required: true,
                    initialized: false,
                    dependsOn: ['Core']
                },
                {
                    name: 'TaskManager',
                    check: () => window.TaskManager,
                    init: () => window.TaskManager.init(),
                    required: true,
                    initialized: false,
                    dependsOn: ['Core', 'TaskIntegration']
                },
                {
                    name: 'DailyBonus',
                    check: () => window.DailyBonus,
                    init: () => window.DailyBonus.init(),
                    required: true,
                    initialized: false,
                    dependsOn: ['TaskManager']
                }
            ];

            // Функція для перевірки, чи всі залежності ініціалізовані
            const checkDependencies = (component) => {
                if (!component.dependsOn) return true;
                return component.dependsOn.every(dependency => {
                    const dep = initializationPlan.find(item => item.name === dependency);
                    return dep && dep.initialized;
                });
            };

            // Запуск ініціалізаторів з перевіркою готовності
            function runInitializers() {
                // Спочатку виконуємо ініціалізацію компонентів без залежностей
                initializationPlan.forEach(component => {
                    if (!component.initialized && component.check() && (!component.dependsOn || checkDependencies(component))) {
                        try {
                            component.init();
                            component.initialized = true;
                            console.log(`Ініціалізовано: ${component.name}`);
                        } catch(e) {
                            console.error(`Помилка ініціалізації ${component.name}:`, e);
                        }
                    }
                });

                // Перевіряємо, чи є неініціалізовані обов'язкові компоненти
                const pendingRequired = initializationPlan.filter(
                    component => component.required && !component.initialized
                );

                if (pendingRequired.length > 0) {
                    console.log(`Очікуємо ініціалізації компонентів: ${pendingRequired.map(c => c.name).join(', ')}`);
                    setTimeout(runInitializers, 100);
                } else {
                    // Всі обов'язкові компоненти ініціалізовано
                    console.log('Всі обов\'язкові компоненти ініціалізовано');

                    // Запускаємо діагностику
                    diagnoseSystemState();

                    // Приховуємо індикатор завантаження
                    const loadingIndicator = document.getElementById('initial-loading');
                    if (loadingIndicator) {
                        loadingIndicator.style.opacity = '0';
                        setTimeout(() => {
                            loadingIndicator.style.display = 'none';
                        }, 300);
                    }

                    // Перевірка і відновлення кнопки бонусу
                    ensureDailyBonusVisible();
                }
            }

            // ВИПРАВЛЕНО: Виділена функція для перевірки видимості кнопки бонусу
            function ensureDailyBonusVisible() {
                const claimButton = document.getElementById('claim-daily');
                if (!claimButton || claimButton.style.display === 'none') {
                    console.log('Відновлення видимості кнопки щоденного бонусу');
                    const bonusContainer = document.querySelector('.daily-bonus');

                    if (bonusContainer) {
                        // Якщо кнопка існує але прихована
                        if (claimButton) {
                            claimButton.style.display = 'block';
                            claimButton.style.visibility = 'visible';
                            claimButton.style.opacity = '1';
                        }
                        // Якщо кнопка не існує
                        else {
                            const newButton = document.createElement('button');
                            newButton.id = 'claim-daily';
                            newButton.className = 'claim-button';
                            newButton.setAttribute('data-lang-key', 'earn.get');
                            newButton.textContent = 'Отримати бонус';

                            bonusContainer.appendChild(newButton);

                            // Додаємо обробник подій, якщо DailyBonus доступний
                            if (window.DailyBonus && typeof window.DailyBonus.handleClaimButtonClick === 'function') {
                                newButton.addEventListener('click', window.DailyBonus.handleClaimButtonClick);
                            }
                        }
                    }
                }
            }

            // Запускаємо ініціалізатори
            setTimeout(runInitializers, 100);

            // ВИПРАВЛЕНО: Виправлений спосіб перемикання вкладок для кращої надійності
            setupTabSwitching();
        });

        // ВИПРАВЛЕНО: Оновлена функція для перемикання вкладок
        function setupTabSwitching() {
            const tabs = document.querySelectorAll('.tab');
            const contentSections = document.querySelectorAll('.content-section');

            // Відслідковуємо стан перемикання
            let isTabSwitching = false;
            let tabSwitchTimeout = null;

            // Функція для перемикання вкладок з захистом від збоїв
            function switchTab(tabType) {
                // Захист від одночасних перемикань
                if (isTabSwitching) return;
                isTabSwitching = true;

                // Встановлюємо таймаут для примусового завершення перемикання
                clearTimeout(tabSwitchTimeout);
                tabSwitchTimeout = setTimeout(() => {
                    isTabSwitching = false;
                }, 2000);

                console.log('Перемикання на вкладку:', tabType);

                // Активація вкладки
                tabs.forEach(tab => {
                    if (tab.getAttribute('data-tab') === tabType) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });

                // Приховуємо всі вкладки
                contentSections.forEach(section => {
                    // Зникнення з анімацією
                    section.style.opacity = '0';
                });

                // Через затримку показуємо потрібну вкладку
                setTimeout(() => {
                    contentSections.forEach(section => {
                        const sectionId = section.id;
                        const sectionType = sectionId.replace('-content', '');

                        if (sectionType === tabType) {
                            // Явно встановлюємо стилі та класи для активної вкладки
                            section.style.display = 'block';
                            section.classList.add('active');

                            // Затримка для запуску анімації появи
                            setTimeout(() => {
                                section.style.opacity = '1';

                                // Переконуємося, що кнопка бонусу видима
                                if (tabType === 'social') {
                                    ensureDailyBonusVisible();
                                }

                                // Завершення процесу перемикання
                                isTabSwitching = false;
                                clearTimeout(tabSwitchTimeout);
                            }, 50);
                        } else {
                            // Приховуємо неактивні вкладки
                            section.classList.remove('active');
                            section.style.display = 'none';
                        }
                    });

                    // Зберігаємо вибір користувача
                    try {
                        localStorage.setItem('active_tasks_tab', tabType);
                    } catch (e) {
                        console.warn('Помилка збереження вкладки:', e);
                    }
                }, 250);
            }

            // Додаємо обробники до вкладок
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabType = this.getAttribute('data-tab');

                    // Перевіряємо, чи вкладка не активна вже
                    if (!this.classList.contains('active')) {
                        switchTab(tabType);
                    }
                });
            });

            // Відновлюємо вибір користувача при завантаженні
            try {
                const savedTab = localStorage.getItem('active_tasks_tab');
                if (savedTab) {
                    // Затримка для кращої стабільності
                    setTimeout(() => {
                        switchTab(savedTab);
                    }, 500);
                }
            } catch (e) {
                console.warn('Помилка відновлення вкладки:', e);
            }
        }

        // Обробка події завантаження сторінки
        window.addEventListener('load', function() {
            console.log('All resources loaded');

            // Приховуємо індикатор завантаження
            const loadingIndicator = document.getElementById('initial-loading');
            if (loadingIndicator) {
                loadingIndicator.style.opacity = '0';
                setTimeout(() => {
                    loadingIndicator.style.display = 'none';
                }, 300);
            }

            // Оновлення контентних зон, якщо необхідно
            if (window.TaskManager && window.TaskManager.refreshAllTasks) {
                window.TaskManager.refreshAllTasks();
            }

            // Переконуємося, що кнопка бонусу видима
            const activeTab = localStorage.getItem('active_tasks_tab') || 'social';
            if (activeTab === 'social') {
                ensureDailyBonusVisible();
            }
        });

        // ВИПРАВЛЕНО: Покращена обробка помилок завантаження скриптів
        window.addEventListener('error', function(e) {
            if (e.target && e.target.tagName === 'SCRIPT') {
                console.error('Failed to load script:', e.target.src);

                // Спробуємо перезавантажити скрипт, але лише один раз
                const failedScript = e.target;
                const scriptSrc = failedScript.src;

                if (scriptSrc && !scriptSrc.includes('already-retried')) {
                    console.log('Attempting to reload script:', scriptSrc);

                    // Створюємо новий елемент script
                    const newScript = document.createElement('script');
                    newScript.src = scriptSrc + '?already-retried=true';

                    // Зберігаємо оригінальні атрибути
                    Array.from(failedScript.attributes).forEach(attr => {
                        if (attr.name !== 'src') {
                            newScript.setAttribute(attr.name, attr.value);
                        }
                    });

                    // Відслідковуємо успішне завантаження
                    newScript.onload = function() {
                        console.log('Successfully reloaded script:', scriptSrc);

                        // Запускаємо ініціалізацію після перезавантаження скрипта
                        if (scriptSrc.includes('task-manager.js') && window.TaskManager) {
                            window.TaskManager.init();
                        } else if (scriptSrc.includes('daily-bonus.js') && window.DailyBonus) {
                            window.DailyBonus.init();
                        }
                    };

                    // Замінюємо старий елемент
                    failedScript.parentNode.replaceChild(newScript, failedScript);
                }
            }
        }, true);

// ВИПРАВЛЕНО: Функція для видимості кнопки бонусу
function ensureDailyBonusVisible() {
    const claimButton = document.getElementById('claim-daily');

    // Якщо кнопка не знайдена або прихована, спробуємо її відновити
    if (!claimButton || window.getComputedStyle(claimButton).display === 'none') {
        console.log('Відновлення видимості кнопки щоденного бонусу');

        // Знаходимо контейнер для кнопки
        const bonusContainer = document.querySelector('.daily-bonus');

        if (bonusContainer) {
            if (claimButton) {
                // Явно встановлюємо стилі для видимості
                claimButton.style.display = 'block';
                claimButton.style.visibility = 'visible';
                claimButton.style.opacity = '1';
                claimButton.style.pointerEvents = 'auto';
            } else {
                // Створюємо нову кнопку, якщо оригінальна не знайдена
                const newButton = document.createElement('button');
                newButton.id = 'claim-daily';
                newButton.className = 'claim-button';
                newButton.setAttribute('data-lang-key', 'earn.get');
                newButton.textContent = 'Отримати бонус';
                bonusContainer.appendChild(newButton);

                // Додаємо обробник, якщо DailyBonus доступний
                if (window.DailyBonus && typeof window.DailyBonus.handleClaimButtonClick === 'function') {
                    newButton.addEventListener('click', window.DailyBonus.handleClaimButtonClick);
                } else {
                    // Якщо DailyBonus ще не завантажено, додаємо подію для відкладеного додавання обробника
                    document.addEventListener('daily-bonus-initialized', function() {
                        if (window.DailyBonus && typeof window.DailyBonus.handleClaimButtonClick === 'function') {
                            const button = document.getElementById('claim-daily');
                            if (button) {
                                button.addEventListener('click', window.DailyBonus.handleClaimButtonClick);
                            }
                        }
                    });
                }
            }
        }
    }

    // Встановлюємо регулярну перевірку видимості кнопки бонусу
    setTimeout(checkBonusButtonVisibility, 1000);
}

// ВИПРАВЛЕНО: Додаткова перевірка видимості кнопки бонусу
function checkBonusButtonVisibility() {
    const activeTab = document.querySelector('.tab.active');
    if (activeTab && activeTab.getAttribute('data-tab') === 'social') {
        const claimButton = document.getElementById('claim-daily');
        if (!claimButton || window.getComputedStyle(claimButton).display === 'none') {
            ensureDailyBonusVisible();
        }
    }
}

// ВИПРАВЛЕНО: Регулярна перевірка і відновлення прогрес-барів
function fixProgressBars() {
    // Знаходимо всі прогрес-бари
    const progressBars = document.querySelectorAll('.progress-fill');

    progressBars.forEach(bar => {
        // Отримуємо елемент завдання
        const taskItem = bar.closest('.task-item');
        if (!taskItem) return;

        // Отримуємо інформацію про прогрес з тексту
        const progressText = taskItem.querySelector('.progress-text');
        if (progressText) {
            const progressInfo = progressText.textContent.trim();
            const match = progressInfo.match(/(\d+)\/(\d+)/);

            if (match && match.length === 3) {
                const current = parseInt(match[1]);
                const total = parseInt(match[2]);

                if (!isNaN(current) && !isNaN(total) && total > 0) {
                    // Розраховуємо відсоток
                    const percent = Math.min(100, Math.floor((current / total) * 100));

                    // Встановлюємо ширину прогрес-бару з високою специфічністю
                    bar.setAttribute('style', `width: ${percent}% !important`);

                    // Якщо прогрес 100%, оновлюємо стан
                    if (percent >= 100 && !taskItem.classList.contains('completed')) {
                        bar.classList.add('complete');
                        taskItem.classList.add('completed');

                        // Знаходимо контейнер дій
                        const actionElement = taskItem.querySelector('.task-action');
                        if (actionElement) {
                            actionElement.innerHTML = '<div class="completed-label">Виконано</div>';
                        }
                    }
                }
            }
        }
    });
}

// Регулярний запуск перевірки для прогрес-барів і кнопки бонусу
setInterval(function() {
    // Перевірка прогрес-барів
    fixProgressBars();

    // Перевірка кнопки бонусу, якщо активна вкладка соціальних завдань
    const activeTab = document.querySelector('.tab.active');
    if (activeTab && activeTab.getAttribute('data-tab') === 'social') {
        checkBonusButtonVisibility();
    }
}, 2000);
    </script>
</body>
</html>